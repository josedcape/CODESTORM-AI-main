{% extends "base.html" %}

{% block title %}Corrector de Código - Codestorm Assistant{% endblock %}

{% block content %}
<div class="container mt-4 fade-in">
    <div class="row">
        <div class="col-12">
            <div class="glass-card">
                <div class="card-header-gradient d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0"><i class="bi bi-code-slash me-2"></i>Corrector Inteligente de Código</h5>
                    <div class="neon-badge pulse" id="model-badge">Modelo: Cargando...</div>
                </div>
                <div class="card-body">
                    <div class="alert alert-cyber">
                        <div class="alert-icon"><i class="bi bi-cpu"></i></div>
                        <div class="alert-content">
                            Este corrector utiliza modelos avanzados de IA para analizar tu código, corregir errores y optimizar siguiendo las mejores prácticas.
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="code-language" class="form-label glow-text">Lenguaje</label>
                            <div class="select-wrapper">
                                <select class="form-select cyber-select" id="code-language">
                                    <option value="python" selected>Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="typescript">TypeScript</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                    <option value="csharp">C#</option>
                                    <option value="php">PHP</option>
                                    <option value="ruby">Ruby</option>
                                    <option value="go">Go</option>
                                    <option value="swift">Swift</option>
                                    <option value="kotlin">Kotlin</option>
                                    <option value="rust">Rust</option>
                                    <option value="html">HTML</option>
                                    <option value="css">CSS</option>
                                    <option value="sql">SQL</option>
                                </select>
                                <i class="bi bi-chevron-down select-arrow"></i>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="model-select" class="form-label glow-text">Modelo de IA</label>
                            <div class="select-wrapper">
                                <select class="form-select cyber-select" id="model-select">
                                    <option value="openai" selected>OpenAI GPT-4o</option>
                                    <option value="anthropic">Claude 3.5 Sonnet</option>
                                    <option value="gemini">Gemini 1.5 Pro</option>
                                </select>
                                <i class="bi bi-chevron-down select-arrow"></i>
                            </div>
                            <div id="api-status" class="mt-2 small status-text">Verificando disponibilidad de modelos...</div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="code-input" class="form-label glow-text">Código a corregir</label>
                        <div class="code-editor-container position-relative">
                            <textarea class="form-control cyber-editor" id="code-input" rows="12" placeholder="Pega aquí tu código..."></textarea>
                            <button class="btn btn-sm btn-cyber-outline position-absolute top-0 end-0 m-2 tooltip-trigger" id="format-code-btn" data-tooltip="Formatear código">
                                <i class="bi bi-braces"></i>
                            </button>
                            <div class="editor-glow"></div>
                        </div>
                    </div>

                    <div class="accordion mb-3 cyber-accordion" id="optionsAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOptions">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOptions" aria-expanded="false" aria-controls="collapseOptions">
                                    <i class="bi bi-sliders me-2"></i>Opciones avanzadas
                                </button>
                            </h2>
                            <div id="collapseOptions" class="accordion-collapse collapse" aria-labelledby="headingOptions" data-bs-parent="#optionsAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label for="instructions" class="form-label">Instrucciones específicas</label>
                                        <textarea class="form-control cyber-editor" id="instructions" rows="2" placeholder="Instrucciones específicas para la corrección..."></textarea>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="cyber-checkbox mb-2">
                                                <input class="cyber-checkbox-input" type="checkbox" id="auto-fix" checked>
                                                <label class="cyber-checkbox-label" for="auto-fix">
                                                    Corrección automática de errores
                                                </label>
                                            </div>
                                            <div class="cyber-checkbox mb-2">
                                                <input class="cyber-checkbox-input" type="checkbox" id="optimize-code" checked>
                                                <label class="cyber-checkbox-label" for="optimize-code">
                                                    Optimizar rendimiento
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="cyber-checkbox mb-2">
                                                <input class="cyber-checkbox-input" type="checkbox" id="improve-readability" checked>
                                                <label class="cyber-checkbox-label" for="improve-readability">
                                                    Mejorar legibilidad
                                                </label>
                                            </div>
                                            <div class="cyber-checkbox mb-2">
                                                <input class="cyber-checkbox-input" type="checkbox" id="follow-conventions">
                                                <label class="cyber-checkbox-label" for="follow-conventions">
                                                    Seguir convenciones estrictas
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-3">
                                        <label class="form-label d-block">Nivel de corrección</label>
                                        <div class="cyber-radio-group">
                                            <input type="radio" class="cyber-radio-input" name="correction-level" id="level-minimal" value="minimal">
                                            <label class="cyber-radio-label" for="level-minimal">Mínimo</label>

                                            <input type="radio" class="cyber-radio-input" name="correction-level" id="level-moderate" value="moderate" checked>
                                            <label class="cyber-radio-label" for="level-moderate">Moderado</label>

                                            <input type="radio" class="cyber-radio-input" name="correction-level" id="level-aggressive" value="aggressive">
                                            <label class="cyber-radio-label" for="level-aggressive">Agresivo</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 action-buttons">
                        <button class="btn btn-cyber-primary" id="process-btn">
                            <span class="btn-content"><i class="bi bi-wrench"></i> Corregir código</span>
                        </button>
                        <button class="btn btn-cyber-secondary" id="debug-btn">
                            <span class="btn-content"><i class="bi bi-bug"></i> Depurador inteligente</span>
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-cyber-dark dropdown-toggle" type="button" id="toolsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <span class="btn-content"><i class="bi bi-tools"></i> Herramientas</span>
                            </button>
                            <ul class="dropdown-menu cyber-dropdown" aria-labelledby="toolsDropdown">
                                <li><a class="dropdown-item" href="#" id="analyze-complexity-btn"><i class="bi bi-graph-up"></i> Analizar complejidad</a></li>
                                <li><a class="dropdown-item" href="#" id="security-check-btn"><i class="bi bi-shield-check"></i> Verificar seguridad</a></li>
                                <li><a class="dropdown-item" href="#" id="generate-tests-btn"><i class="bi bi-check2-circle"></i> Generar tests</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="explain-code-btn"><i class="bi bi-chat-quote"></i> Explicar código</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4 slide-up" id="results-container" style="display: none;">
        <div class="col-12">
            <div class="glass-card">
                <div class="card-header-gradient-success d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0"><i class="bi bi-check-circle me-2"></i>Resultados</h5>
                    <div class="d-flex">
                        <button class="btn btn-sm btn-cyber-light me-2 tooltip-trigger" id="copy-btn" data-tooltip="Copiar al portapapeles">
                            <i class="bi bi-clipboard"></i> Copiar
                        </button>
                        <button class="btn btn-sm btn-cyber-light me-2 tooltip-trigger" id="download-btn" data-tooltip="Descargar archivo">
                            <i class="bi bi-download"></i> Descargar
                        </button>
                        <button class="btn btn-sm btn-cyber-light tooltip-trigger" id="apply-fix-btn" data-tooltip="Aplicar al editor">
                            <i class="bi bi-magic"></i> Aplicar corrección
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs cyber-tabs" id="result-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="code-tab" data-bs-toggle="tab" data-bs-target="#code-content" type="button" role="tab" aria-controls="code-content" aria-selected="true">
                                <i class="bi bi-code-square me-1"></i>Código corregido
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="diff-tab" data-bs-toggle="tab" data-bs-target="#diff-content" type="button" role="tab" aria-controls="diff-content" aria-selected="false">
                                <i class="bi bi-file-diff me-1"></i>Diferencias
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="changes-tab" data-bs-toggle="tab" data-bs-target="#changes-content" type="button" role="tab" aria-controls="changes-content" aria-selected="false">
                                <i class="bi bi-list-check me-1"></i>Cambios
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="explanation-tab" data-bs-toggle="tab" data-bs-target="#explanation-content" type="button" role="tab" aria-controls="explanation-content" aria-selected="false">
                                <i class="bi bi-journal-text me-1"></i>Explicación
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="metrics-tab" data-bs-toggle="tab" data-bs-target="#metrics-content" type="button" role="tab" aria-controls="metrics-content" aria-selected="false">
                                <i class="bi bi-bar-chart me-1"></i>Métricas
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="result-tabs-content">
                        <div class="tab-pane fade show active" id="code-content" role="tabpanel" aria-labelledby="code-tab">
                            <div class="d-flex justify-content-end mb-2">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-cyber-outline-sm" id="toggle-line-numbers">
                                        <i class="bi bi-list-ol me-1"></i>Mostrar números de línea
                                    </button>
                                    <button class="btn btn-cyber-outline-sm" id="toggle-syntax-highlight">
                                        <i class="bi bi-palette me-1"></i>Resaltado de sintaxis
                                    </button>
                                </div>
                            </div>
                            <div class="cyber-code-container">
                                <pre><code id="corrected-code" class="language-python"></code></pre>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="diff-content" role="tabpanel" aria-labelledby="diff-tab">
                            <div class="d-flex justify-content-end mb-2">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-cyber-outline-sm active" id="inline-diff">
                                        <i class="bi bi-list me-1"></i>Vista en línea
                                    </button>
                                    <button class="btn btn-cyber-outline-sm" id="side-by-side-diff">
                                        <i class="bi bi-layout-split me-1"></i>Vista lado a lado
                                    </button>
                                </div>
                            </div>
                            <div class="cyber-code-container" id="diff-view-container">
                                <pre><code id="diff-view" class="language-diff"></code></pre>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="changes-content" role="tabpanel" aria-labelledby="changes-tab">
                            <div class="mb-3">
                                <div class="cyber-search">
                                    <i class="bi bi-search search-icon"></i>
                                    <input type="text" class="form-control" id="filter-changes" placeholder="Filtrar cambios...">
                                </div>
                            </div>
                            <div id="changes-list" class="cyber-list">
                                <!-- Los cambios se listarán aquí dinámicamente -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="explanation-content" role="tabpanel" aria-labelledby="explanation-tab">
                            <div id="explanation-text" class="cyber-markdown">
                                <!-- La explicación se mostrará aquí -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="metrics-content" role="tabpanel" aria-labelledby="metrics-tab">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="glass-card mb-3">
                                        <div class="card-header-mini">
                                            <i class="bi bi-clipboard-data me-2"></i>Métricas de código
                                        </div>
                                        <div class="card-body">
                                            <table class="table table-sm cyber-table">
                                                <tbody id="code-metrics">
                                                    <!-- Métricas de código se mostrarán aquí -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="glass-card mb-3">
                                        <div class="card-header-mini">
                                            <i class="bi bi-stars me-2"></i>Calidad del código
                                        </div>
                                        <div class="card-body chart-container">
                                            <canvas id="quality-chart" height="200"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="glass-card">
                                <div class="card-header-mini">
                                    <i class="bi bi-lightbulb me-2"></i>Recomendaciones adicionales
                                </div>
                                <div class="card-body">
                                    <ul id="recommendations-list" class="cyber-list">
                                        <!-- Recomendaciones se mostrarán aquí -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Debugger -->
<div class="modal fade cyber-modal" id="debug-modal" tabindex="-1" aria-labelledby="debug-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header cyber-modal-header">
                <h5 class="modal-title" id="debug-modal-label"><i class="bi bi-bug me-2"></i>Depurador Inteligente</h5>
                <button type="button" class="btn-close neon-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-cyber">
                    <div class="alert-icon"><i class="bi bi-info-circle"></i></div>
                    <div class="alert-content">
                        El depurador analizará tu código en busca de errores lógicos, problemas de rendimiento y vulnerabilidades.
                    </div>
                </div>
                <div class="mb-3">
                    <label for="error-message" class="form-label glow-text">Mensaje de error (opcional)</label>
                    <textarea class="form-control cyber-editor" id="error-message" rows="3" placeholder="Pega aquí el mensaje de error si lo tienes..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label glow-text">Tipo de análisis</label>
                    <div class="cyber-checkbox">
                        <input class="cyber-checkbox-input" type="checkbox" id="check-syntax" checked>
                        <label class="cyber-checkbox-label" for="check-syntax">Errores de sintaxis</label>
                    </div>
                    <div class="cyber-checkbox">
                        <input class="cyber-checkbox-input" type="checkbox" id="check-logic" checked>
                        <label class="cyber-checkbox-label" for="check-logic">Errores lógicos</label>
                    </div>
                    <div class="cyber-checkbox">
                        <input class="cyber-checkbox-input" type="checkbox" id="check-performance">
                        <label class="cyber-checkbox-label" for="check-performance">Problemas de rendimiento</label>
                    </div>
                    <div class="cyber-checkbox">
                        <input class="cyber-checkbox-input" type="checkbox" id="check-security">
                        <label class="cyber-checkbox-label" for="check-security">Vulnerabilidades de seguridad</label>
                    </div>
                </div>
                <div class="cyber-progress mb-3" style="display: none;">
                    <div class="cyber-progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
                <div id="debug-result" class="cyber-result" style="display: none;">
                    <ul class="nav nav-tabs cyber-tabs" id="debug-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="diagnosis-tab" data-bs-toggle="tab" data-bs-target="#diagnosis-content" type="button" role="tab" aria-controls="diagnosis-content" aria-selected="true">
                                <i class="bi bi-search me-1"></i>Diagnóstico
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="solution-tab" data-bs-toggle="tab" data-bs-target="#solution-content" type="button" role="tab" aria-controls="solution-content" aria-selected="false">
                                <i class="bi bi-wrench-adjustable me-1"></i>Solución
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details-content" type="button" role="tab" aria-controls="details-content" aria-selected="false">
                                <i class="bi bi-file-earmark-code me-1"></i>Detalles técnicos
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content mt-3" id="debug-tabs-content">
                        <div class="tab-pane fade show active" id="diagnosis-content" role="tabpanel" aria-labelledby="diagnosis-tab">
                            <div id="debug-diagnosis" class="mb-3"></div>
                        </div>
                        <div class="tab-pane fade" id="solution-content" role="tabpanel" aria-labelledby="solution-tab">
                            <div class="cyber-code-container">
                                <pre><code id="debug-fix" class="language-python"></code></pre>
                            </div>
                            <div class="d-flex justify-content-end mt-3">
                                <button id="apply-debug-fix" class="btn btn-cyber-success">
                                    <span class="btn-content"><i class="bi bi-check-lg"></i> Aplicar solución</span>
                                </button>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="details-content" role="tabpanel" aria-labelledby="details-tab">
                            <div id="debug-details" class="mb-3 cyber-markdown"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cyber-secondary" data-bs-dismiss="modal">
                    <span class="btn-content">Cerrar</span>
                </button>
                <button type="button" class="btn btn-cyber-primary" id="start-debug">
                    <span class="btn-content"><i class="bi bi-play-fill"></i> Iniciar análisis</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Análisis de Complejidad -->
<div class="modal fade cyber-modal" id="complexity-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header cyber-modal-header">
                <h5 class="modal-title"><i class="bi bi-graph-up me-2"></i>Análisis de Complejidad</h5>
                <button type="button" class="btn-close neon-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="complexity-loading" class="text-center py-5">
                    <div class="cyber-spinner">
                        <div class="cyber-spinner-inner"></div>
                    </div>
                    <p class="mt-3 glow-text">Analizando la complejidad del código...</p>
                </div>
                <div id="complexity-results" style="display: none;">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="glass-card mb-3">
                                <div class="card-header-mini">
                                    <i class="bi bi-diagram-3 me-2"></i>Complejidad ciclomática
                                </div>
                                <div class="card-body chart-container">
                                    <canvas id="complexity-chart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="glass-card mb-3">
                                <div class="card-header-mini">
                                    <i class="bi bi-clipboard-data me-2"></i>Estadísticas
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm cyber-table" id="complexity-stats">
                                        <!-- Estadísticas de complejidad -->
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card">
                        <div class="card-header-mini">
                            <i class="bi bi-code-slash me-2"></i>Funciones/Métodos por complejidad
                        </div>
                        <div class="card-body p-0">
                            <table class="table cyber-table mb-0" id="functions-complexity">
                                <thead>
                                    <tr>
                                        <th>Función/Método</th>
                                        <th>Complejidad</th>
                                        <th>Líneas</th>
                                        <th>Recomendación</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Datos de complejidad por función -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cyber-secondary" data-bs-dismiss="modal">
                    <span class="btn-content">Cerrar</span>
                </button>
                <button type="button" class="btn btn-cyber-primary" id="export-complexity">
                    <span class="btn-content"><i class="bi bi-download"></i> Exportar informe</span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/diff/5.1.0/diff.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elementos principales
    const codeInput = document.getElementById('code-input');
    const codeLanguage = document.getElementById('code-language');
    const instructions = document.getElementById('instructions');
    const modelSelect = document.getElementById('model-select');
    const autoFix = document.getElementById('auto-fix');
    const optimizeCode = document.getElementById('optimize-code');
    const improveReadability = document.getElementById('improve-readability');
    const followConventions = document.getElementById('follow-conventions');
    const processBtn = document.getElementById('process-btn');
    const debugBtn = document.getElementById('debug-btn');
    const formatCodeBtn = document.getElementById('format-code-btn');
    const resultsContainer = document.getElementById('results-container');
    const correctedCode = document.getElementById('corrected-code');
    const diffView = document.getElementById('diff-view');
    const changesList = document.getElementById('changes-list');
    const explanationText = document.getElementById('explanation-text');
    const copyBtn = document.getElementById('copy-btn');
    const downloadBtn = document.getElementById('download-btn');
    const applyFixBtn = document.getElementById('apply-fix-btn');
    const modelBadge = document.getElementById('model-badge');
    const filterChanges = document.getElementById('filter-changes');

    // Botones de herramientas adicionales
    const analyzeComplexityBtn = document.getElementById('analyze-complexity-btn');
    const securityCheckBtn = document.getElementById('security-check-btn');
    const generateTestsBtn = document.getElementById('generate-tests-btn');
    const explainCodeBtn = document.getElementById('explain-code-btn');

    // Elementos para controlar visualización
    const toggleLineNumbers = document.getElementById('toggle-line-numbers');
    const toggleSyntaxHighlight = document.getElementById('toggle-syntax-highlight');
    const inlineDiff = document.getElementById('inline-diff');
    const sideBySideDiff = document.getElementById('side-by-side-diff');

    // Elementos del modal de depuración
    const debugModal = new bootstrap.Modal(document.getElementById('debug-modal'));
    const errorMessage = document.getElementById('error-message');
    const startDebugBtn = document.getElementById('start-debug');
    const debugResult = document.getElementById('debug-result');
    const debugDiagnosis = document.getElementById('debug-diagnosis');
    const debugFix = document.getElementById('debug-fix');
    const debugDetails = document.getElementById('debug-details');
    const applyDebugFixBtn = document.getElementById('apply-debug-fix');
    const progressBar = document.querySelector('.cyber-progress');
    const progressBarInner = document.querySelector('.cyber-progress-bar');

    // Elementos del modal de complejidad
    const complexityModal = new bootstrap.Modal(document.getElementById('complexity-modal'));
    const complexityLoading = document.getElementById('complexity-loading');
    const complexityResults = document.getElementById('complexity-results');

    // Inicializar tooltips
    document.querySelectorAll('.tooltip-trigger').forEach(el => {
        const tooltip = document.createElement('div');
        tooltip.className = 'cyber-tooltip';
        tooltip.textContent = el.getAttribute('data-tooltip');
        el.appendChild(tooltip);

        el.addEventListener('mouseenter', () => {
            tooltip.classList.add('show-tooltip');
        });

        el.addEventListener('mouseleave', () => {
            tooltip.classList.remove('show-tooltip');
        });
    });

    // Actualizar el badge del modelo seleccionado con animación
    modelSelect.addEventListener('change', function() {
        const selectedOption = modelSelect.options[modelSelect.selectedIndex];
        modelBadge.classList.add('badge-update');
        setTimeout(() => {
            modelBadge.textContent = `Modelo: ${selectedOption.text}`;
            modelBadge.classList.remove('badge-update');
        }, 300);
    });

    // Inicializar el badge del modelo
    const initialOption = modelSelect.options[modelSelect.selectedIndex];
    modelBadge.textContent = `Modelo: ${initialOption.text}`;

    // Verificar disponibilidad de modelos - Mejorado con mejor manejo de errores y feedback
    fetch('/api/health')
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error de servidor: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const apiStatus = document.getElementById('api-status');
            const apis = data.apis || {};
            let availableModels = [];
            let unavailableModels = [];

            // Mapeo de IDs de modelos a nombres más amigables
            const modelMapping = {
                'gpt4o': 'OpenAI GPT-4o',
                'gpt4-turbo': 'OpenAI GPT-4 Turbo',
                'claude-3-5-sonnet': 'Claude 3.5 Sonnet',
                'claude-3-5-opus': 'Claude 3.5 Opus',
                'claude-3-7-sonnet': 'Claude 3.7 Sonnet',
                'gemini-1-5-pro': 'Gemini 1.5 Pro',
                'gemini-1-5-ultra': 'Gemini 1.5 Ultra'
            };

            // Actualizar opciones del selector de modelos
            for (const [model, status] of Object.entries(apis)) {
                const option = modelSelect.querySelector(`option[value="${model}"]`);
                if (option) {
                    if (status !== 'ok') {
                        option.disabled = true;
                        option.textContent += ' (no disponible)';
                        unavailableModels.push(modelMapping[model] || model);
                    } else {
                        availableModels.push(modelMapping[model] || model);
                    }
                }
            }

            // Seleccionar el primer modelo disponible
            const firstEnabled = Array.from(modelSelect.options).find(opt => !opt.disabled);
            if (firstEnabled) {
                firstEnabled.selected = true;
                modelBadge.textContent = `Modelo: ${firstEnabled.text}`;
            }

            // Mostrar estado de disponibilidad con animación
            if (availableModels.length > 0) {
                apiStatus.innerHTML = `<span class="status-success"><i class="bi bi-check-circle"></i> Modelos disponibles:</span> ${availableModels.join(', ')}`;
                if (unavailableModels.length > 0) {
                    apiStatus.innerHTML += `<br><span class="status-warning"><i class="bi bi-exclamation-triangle"></i> No disponibles:</span> ${unavailableModels.join(', ')}`;
                }
                apiStatus.classList.add('fade-in');
            } else {
                apiStatus.innerHTML = `<span class="status-error"><i class="bi bi-x-circle"></i> No hay modelos configurados. Configura una API en el panel de Secrets.</span>`;
                processBtn.disabled = true;
                apiStatus.classList.add('pulse-error');
            }
        })
        .catch(error => {
            console.error('Error al verificar APIs:', error);
            const apiStatus = document.getElementById('api-status');
            apiStatus.innerHTML = `<span class="status-error"><i class="bi bi-x-circle"></i> Error al verificar disponibilidad: ${error.message}</span>`;
            apiStatus.classList.add('pulse-error');
        });

    // Función mejorada para generar diff con resaltado de sintaxis
    function generateDiff(original, corrected) {
        if (!original || !corrected) return '';

        const diffLines = Diff.diffLines(original, corrected);
        let diffResult = '';

        diffLines.forEach(part => {
            // Marcar las líneas como agregadas, removidas o iguales
            const prefix = part.added ? '+' : part.removed ? '-' : ' ';
            const cssClass = part.added ? 'diff-added' : part.removed ? 'diff-removed' : 'diff-unchanged';

            // Dividir en líneas y agregar el prefijo con clases CSS
            const lines = part.value.split('\n').filter(line => line.length > 0);
            lines.forEach(line => {
                diffResult += `<div class="${cssClass}"><span class="diff-prefix">${prefix}</span>${escapeHtml(line)}</div>`;
            });
        });

        return diffResult;
    }

    // Función para generar diff lado a lado con animación
    function generateSideBySideDiff(original, corrected) {
        if (!original || !corrected) return '';

        const originalLines = original.split('\n');
        const correctedLines = corrected.split('\n');

        // Usar el algoritmo de diff para encontrar las diferencias
        const diff = Diff.diffLines(original, corrected);

        let result = '<div class="diff-side-by-side">';
        result += '<div class="diff-original"><h6>Original</h6>';
        result += '<div class="diff-content">';

        let originalLineNum = 1;
        let correctedLineNum = 1;

        // Procesar cada parte del diff
        diff.forEach(part => {
            if (part.removed) {
                // Líneas eliminadas solo aparecen en el original
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-removed"><span class="line-number">${originalLineNum++}</span>${escapeHtml(line)}</div>`;
                });
            } else if (part.added) {
                // Las líneas agregadas solo aparecen en el corregido
                // Añadir líneas vacías en el original para mantener la alineación
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-empty"><span class="line-number">${originalLineNum++}</span></div>`;
                });
            } else {
                // Líneas sin cambios aparecen en ambos lados
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-unchanged"><span class="line-number">${originalLineNum++}</span>${escapeHtml(line)}</div>`;
                });
            }
        });

        result += '</div></div>';

        // Lado derecho (código corregido)
        result += '<div class="diff-corrected"><h6>Corregido</h6>';
        result += '<div class="diff-content">';

        // Reiniciar contadores
        originalLineNum = 1;
        correctedLineNum = 1;

        // Procesar cada parte del diff nuevamente para el lado corregido
        diff.forEach(part => {
            if (part.added) {
                // Líneas agregadas aparecen en el corregido
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-added"><span class="line-number">${correctedLineNum++}</span>${escapeHtml(line)}</div>`;
                });
            } else if (part.removed) {
                // Las líneas eliminadas no aparecen en el corregido
                // Añadir líneas vacías para mantener la alineación
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-empty"><span class="line-number">${correctedLineNum++}</span></div>`;
                });
            } else {
                // Líneas sin cambios aparecen en ambos lados
                part.value.split('\n').forEach(line => {
                    if (line.trim() === '') return;
                    result += `<div class="diff-line diff-unchanged"><span class="line-number">${correctedLineNum++}</span>${escapeHtml(line)}</div>`;
                });
            }
        });

        result += '</div></div></div>';

        return result;
    }

    // Función para escapar HTML
    function escapeHtml(text) {
        const element = document.createElement('div');
        element.textContent = text;
        return element.innerHTML;
    }

    // Formatear código con animación
    formatCodeBtn.addEventListener('click', function() {
        const code = codeInput.value.trim();
        const language = codeLanguage.value;

        if (!code) {
            showToast('Por favor, ingresa código para formatear', 'warning');
            return;
        }

        formatCodeBtn.disabled = true;
        formatCodeBtn.innerHTML = '<div class="btn-spinner"></div>';

        // Añadir efecto de procesamiento al editor
        codeInput.classList.add('processing');

        fetch('/api/format_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                code: code,
                language: language
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Animación de transición para el nuevo código
                codeInput.classList.add('fade-out');
                setTimeout(() => {
                    codeInput.value = data.formatted_code;
                    codeInput.classList.remove('fade-out');
                    codeInput.classList.add('fade-in');
                    setTimeout(() => {
                        codeInput.classList.remove('fade-in');
                    }, 500);
                }, 300);

                showToast('Código formateado correctamente', 'success');
            } else {
                showToast(data.error || 'Error al formatear el código', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast(`Error: ${error.message}`, 'error');
        })
        .finally(() => {
            formatCodeBtn.disabled = false;
            formatCodeBtn.innerHTML = '<i class="bi bi-braces"></i>';
            codeInput.classList.remove('processing');
        });
    });

    // Función para mostrar notificaciones toast con animación
    function showToast(message, type = 'info') {
        // Crear elemento toast si no existe
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }

        // Crear toast con estilo futurista
        const toastId = 'toast-' + Date.now();
        const toastHTML = `
            <div id="${toastId}" class="cyber-toast ${type === 'error' ? 'toast-error' : type === 'success' ? 'toast-success' : type === 'warning' ? 'toast-warning' : 'toast-info'}">
                <div class="cyber-toast-header">
                    <i class="bi ${type === 'error' ? 'bi-exclamation-circle' : type === 'success' ? 'bi-check-circle' : type === 'warning' ? 'bi-exclamation-triangle' : 'bi-info-circle'} me-2"></i>
                    <strong class="me-auto">Codestorm Assistant</strong>
                    <button type="button" class="btn-close neon-close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
                <div class="cyber-toast-body">
                    ${message}
                </div>
            </div>
        `;

        toastContainer.insertAdjacentHTML('beforeend', toastHTML);
        const toastElement = document.getElementById(toastId);

        // Animar entrada
        setTimeout(() => {
            toastElement.classList.add('show-toast');
        }, 10);

        // Animar salida y eliminar
        setTimeout(() => {
            toastElement.classList.remove('show-toast');
            toastElement.classList.add('hide-toast');
            setTimeout(() => {
                toastElement.remove();
            }, 500);
        }, 5000);
    }

    // Toggle para mostrar/ocultar números de línea con animación
    toggleLineNumbers.addEventListener('click', function() {
        const codeBlock = document.querySelector('#code-content pre');
        codeBlock.classList.toggle('with-line-numbers');

        if (codeBlock.classList.contains('with-line-numbers')) {
            toggleLineNumbers.innerHTML = '<i class="bi bi-list"></i> Ocultar números de línea';
            addLineNumbers(correctedCode);
        } else {
            toggleLineNumbers.innerHTML = '<i class="bi bi-list-ol"></i> Mostrar números de línea';
            removeLineNumbers(correctedCode);
        }

        // Añadir efecto de transición
        codeBlock.classList.add('flash');
        setTimeout(() => {
            codeBlock.classList.remove('flash');
        }, 300);
    });

    // Toggle para resaltado de sintaxis con animación
    toggleSyntaxHighlight.addEventListener('click', function() {
        correctedCode.classList.toggle('no-highlight');

        if (correctedCode.classList.contains('no-highlight')) {
            toggleSyntaxHighlight.innerHTML = '<i class="bi bi-palette"></i> Activar resaltado';
        } else {
            toggleSyntaxHighlight.innerHTML = '<i class="bi bi-palette-fill"></i> Desactivar resaltado';
            hljs.highlightElement(correctedCode);
        }

        // Añadir efecto de transición
        correctedCode.classList.add('flash');
        setTimeout(() => {
            correctedCode.classList.remove('flash');
        }, 300);
    });

    // Cambiar entre vistas de diff con animación
    inlineDiff.addEventListener('click', function() {
        inlineDiff.classList.add('active');
        sideBySideDiff.classList.remove('active');

        const container = document.getElementById('diff-view-container');
        container.classList.add('fade-out');

        setTimeout(() => {
            container.innerHTML = '<pre><code id="diff-view" class="language-diff"></code></pre>';
            const diffView = document.getElementById('diff-view');
            diffView.innerHTML = generateDiff(codeInput.value.trim(), correctedCode.textContent);
            hljs.highlightElement(diffView);

            container.classList.remove('fade-out');
            container.classList.add('fade-in');

            setTimeout(() => {
                container.classList.remove('fade-in');
            }, 300);
        }, 300);
    });

    sideBySideDiff.addEventListener('click', function() {
        sideBySideDiff.classList.add('active');
        inlineDiff.classList.remove('active');

        const container = document.getElementById('diff-view-container');
        container.classList.add('fade-out');

        setTimeout(() => {
            container.innerHTML = generateSideBySideDiff(codeInput.value.trim(), correctedCode.textContent);

            container.classList.remove('fade-out');
            container.classList.add('fade-in');

            setTimeout(() => {
                container.classList.remove('fade-in');
            }, 300);
        }, 300);
    });

    // Filtrar cambios con animación
    filterChanges.addEventListener('input', function() {
        const filter = filterChanges.value.toLowerCase();
        const items = changesList.querySelectorAll('.cyber-list-item');

        items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(filter)) {
                item.style.display = '';
                item.classList.add('highlight-item');
                setTimeout(() => {
                    item.classList.remove('highlight-item');
                }, 300);
            } else {
                item.classList.add('fade-out-item');
                setTimeout(() => {
                    item.style.display = 'none';
                    item.classList.remove('fade-out-item');
                }, 300);
            }
        });
    });

    // Funciones para agregar/quitar números de línea con estilo futurista
    function addLineNumbers(codeElement) {
        const code = codeElement.textContent;
        const lines = code.split('\n');
        let numberedCode = '';

        lines.forEach((line, index) => {
            numberedCode += `<span class="line-number">${index + 1}</span>${line}\n`;
        });

        codeElement.innerHTML = numberedCode;
        hljs.highlightElement(codeElement);
    }

    function removeLineNumbers(codeElement) {
        const code = codeElement.textContent;
        codeElement.textContent = code;
        hljs.highlightElement(codeElement);
    }

    // Procesar código - Versión mejorada con más opciones y animaciones
    processBtn.addEventListener('click', function() {
        const code = codeInput.value.trim();
        const language = codeLanguage.value;
        const instructionsText = instructions.value.trim();
        const model = modelSelect.value;
        const isAutoFix = autoFix.checked;
        const isOptimize = optimizeCode.checked;
        const isImproveReadability = improveReadability.checked;
        const isFollowConventions = followConventions.checked;
        const correctionLevel = document.querySelector('input[name="correction-level"]:checked').value;

        if (!code) {
            showToast('Por favor, ingresa código para corregir', 'warning');
            return;
        }

        // Mostrar estado de carga con animación
        processBtn.disabled = true;
        processBtn.innerHTML = '<span class="btn-content"><div class="btn-spinner"></div> Procesando...</span>';
        processBtn.classList.add('btn-processing');

        // Ocultar resultados anteriores con animación si están visibles
        if (resultsContainer.style.display !== 'none') {
            resultsContainer.classList.add('slide-down');
            setTimeout(() => {
                resultsContainer.style.display = 'none';
                resultsContainer.classList.remove('slide-down');
            }, 300);
        }

        // Enviar al servidor para procesar con opciones extendidas
        fetch('/api/process_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                code: code,
                language: language,
                instructions: instructionsText || 'Corrige errores y mejora la calidad del código',
                model: model,
                auto_fix: isAutoFix,
                optimize: isOptimize,
                improve_readability: isImproveReadability,
                follow_conventions: isFollowConventions,
                correction_level: correctionLevel
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error en el servidor: ${response.status} ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            if (!data.success) {
                throw new Error(data.error || 'Error desconocido al procesar el código');
            }

            // Actualizar resultados con animaciones
            correctedCode.textContent = data.corrected_code;
            correctedCode.className = `language-${language}`;

            // Generar y mostrar diff
            diffView.innerHTML = generateDiff(code, data.corrected_code);
            diffView.className = 'language-diff';

            // Resaltar código
            hljs.highlightElement(correctedCode);
            hljs.highlightElement(diffView);

            // Mostrar cambios con categorías y niveles de importancia
            changesList.innerHTML = '';
            if (data.changes && data.changes.length > 0) {
                // Agrupar cambios por categoría
                const categorizedChanges = {};
                data.changes.forEach(change => {
                    const category = change.category || 'General';
                    if (!categorizedChanges[category]) {
                        categorizedChanges[category] = [];
                    }
                    categorizedChanges[category].push(change);
                });

                // Mostrar cambios agrupados con animación
                let delay = 0;
                for (const [category, changes] of Object.entries(categorizedChanges)) {
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'cyber-list-header';
                    categoryHeader.innerHTML = `<i class="bi bi-tag me-2"></i>${category}`;
                    categoryHeader.style.animationDelay = `${delay}ms`;
                    changesList.appendChild(categoryHeader);
                    delay += 50;

                    changes.forEach(change => {
                        const item = document.createElement('div');
                        item.className = 'cyber-list-item slide-in-right';
                        item.style.animationDelay = `${delay}ms`;

                        // Determinar badge de importancia con estilo futurista
                        let importanceBadge = '';
                        if (change.importance) {
                            const badgeClass = change.importance === 'alta' ? 'cyber-badge-danger' :
                                              change.importance === 'media' ? 'cyber-badge-warning' : 'cyber-badge-info';
                            importanceBadge = `<span class="cyber-badge ${badgeClass}">${change.importance}</span>`;
                        }

                        // Información de línea con estilo futurista
                        const lineInfo = change.lineNumbers ?
                            `<span class="cyber-badge cyber-badge-secondary">Línea(s): ${change.lineNumbers.join(', ')}</span>` : '';

                        item.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center">
                                <div>${importanceBadge} ${change.description}</div>
                                ${lineInfo}
                            </div>
                        `;

                        changesList.appendChild(item);
                        delay += 50;
                    });
                }
            } else {
                const item = document.createElement('div');
                item.className = 'cyber-list-item slide-in-right';
                item.innerHTML = 'No se detectaron cambios significativos';
                changesList.appendChild(item);
            }

            // Mostrar explicación con mejor formato y animación
            explanationText.innerHTML = marked.parse(data.explanation || 'No se proporcionó una explicación detallada.');
            explanationText.classList.add('fade-in');

            // Mostrar métricas de código con animación
            const codeMetrics = document.getElementById('code-metrics');
            codeMetrics.innerHTML = '';

            if (data.metrics) {
                const metrics = [
                    { name: 'Líneas de código', value: data.metrics.loc || 'N/A', icon: 'bi-file-earmark-text' },
                    { name: 'Complejidad ciclomática', value: data.metrics.complexity || 'N/A', icon: 'bi-diagram-3' },
                    { name: 'Errores corregidos', value: data.metrics.errors_fixed || 'N/A', icon: 'bi-bug' },
                    { name: 'Advertencias resueltas', value: data.metrics.warnings_fixed || 'N/A', icon: 'bi-exclamation-triangle' },
                    { name: 'Mejoras de rendimiento', value: data.metrics.performance_improvements || 'N/A', icon: 'bi-speedometer' },
                    { name: 'Mejoras de legibilidad', value: data.metrics.readability_improvements || 'N/A', icon: 'bi-eye' }
                ];

                let delay = 0;
                metrics.forEach(metric => {
                    const row = document.createElement('tr');
                    row.className = 'fade-in';
                    row.style.animationDelay = `${delay}ms`;
                    row.innerHTML = `
                        <td><i class="bi ${metric.icon} me-2"></i>${metric.name}</td>
                        <td><span class="cyber-value">${metric.value}</span></td>
                    `;
                    codeMetrics.appendChild(row);
                    delay += 100;
                });

                // Generar gráfico de calidad con animación
                if (data.metrics.quality_scores) {
                    // Configuración de tema para Chart.js
                    Chart.defaults.color = '#a0a0a0';
                    Chart.defaults.borderColor = 'rgba(70, 70, 70, 0.5)';

                    const ctx = document.getElementById('quality-chart').getContext('2d');
                    const qualityChart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: Object.keys(data.metrics.quality_scores),
                            datasets: [{
                                label: 'Antes',
                                data: Object.values(data.metrics.quality_scores).map(score => score.before),
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                borderColor: 'rgb(255, 99, 132)',
                                pointBackgroundColor: 'rgb(255, 99, 132)',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: 'rgb(255, 99, 132)'
                            }, {
                                label: 'Después',
                                data: Object.values(data.metrics.quality_scores).map(score => score.after),
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                borderColor: 'rgb(54, 162, 235)',
                                pointBackgroundColor: 'rgb(54, 162, 235)',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: 'rgb(54, 162, 235)'
                            }]
                        },
                        options: {
                            scales: {
                                r: {
                                    min: 0,
                                    max: 10,
                                    ticks: {
                                        backdropColor: 'transparent'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        boxWidth: 15,
                                        padding: 15
                                    }
                                }
                            },
                            animation: {
                                duration: 1500,
                                easing: 'easeOutQuart'
                            }
                        }
                    });
                }
            } else {
                codeMetrics.innerHTML = '<tr><td colspan="2" class="text-center">No hay métricas disponibles</td></tr>';
            }

            // Mostrar recomendaciones con animación
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = '';

            if (data.recommendations && data.recommendations.length > 0) {
                let delay = 0;
                data.recommendations.forEach(recommendation => {
                    const item = document.createElement('li');
                    item.className = 'cyber-list-item slide-in-right';
                    item.style.animationDelay = `${delay}ms`;
                    item.innerHTML = `
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="bi bi-lightbulb cyber-icon-glow"></i>
                            </div>
                            <div>
                                <h6>${recommendation.title}</h6>
                                <p class="mb-0">${recommendation.description}</p>
                            </div>
                        </div>
                    `;
                    recommendationsList.appendChild(item);
                    delay += 100;
                });
            } else {
                const item = document.createElement('li');
                item.className = 'cyber-list-item';
                item.innerHTML = 'No hay recomendaciones adicionales';
                recommendationsList.appendChild(item);
            }

            // Mostrar resultados con animación
            resultsContainer.style.display = 'block';
            resultsContainer.classList.add('slide-up');
            setTimeout(() => {
                resultsContainer.classList.remove('slide-up');
            }, 500);

            // Desplazarse a los resultados con animación suave
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        })
        .catch(error => {
            console.error('Error:', error);
            showToast(`Error al procesar el código: ${error.message}`, 'error');
            })
            .finally(() => {
            // Restaurar botón con animación
            setTimeout(() => {
                processBtn.disabled = false;
                processBtn.classList.remove('btn-processing');
                processBtn.innerHTML = '<span class="btn-content"><i class="bi bi-wrench"></i> Corregir código</span>';
            }, 300);
            });
            });

            // Análisis de complejidad con animaciones avanzadas
            analyzeComplexityBtn.addEventListener('click', function() {
            const code = codeInput.value.trim();
            const language = codeLanguage.value;

            if (!code) {
            showToast('Por favor, ingresa código para analizar', 'warning');
            return;
            }

            complexityLoading.style.display = 'block';
            complexityResults.style.display = 'none';
            complexityModal.show();

            // Simulación del análisis con animación de progreso
            let progress = 0;
            const interval = setInterval(() => {
            progress += 5;
            if (progress >= 100) {
                clearInterval(interval);

                setTimeout(() => {
                    complexityLoading.classList.add('fade-out');
                    setTimeout(() => {
                        complexityLoading.style.display = 'none';
                        complexityResults.style.display = 'block';
                        complexityResults.classList.add('fade-in');

                        // Generar datos de ejemplo para el gráfico con animación
                        const ctx = document.getElementById('complexity-chart').getContext('2d');

                        // Configuración de tema para Chart.js
                        Chart.defaults.color = '#a0a0a0';
                        Chart.defaults.borderColor = 'rgba(70, 70, 70, 0.5)';

                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['Baja', 'Media', 'Alta', 'Muy alta'],
                                datasets: [{
                                    label: 'Funciones por nivel de complejidad',
                                    data: [5, 3, 2, 1],
                                    backgroundColor: [
                                        'rgba(75, 192, 192, 0.6)',
                                        'rgba(255, 206, 86, 0.6)',
                                        'rgba(255, 159, 64, 0.6)',
                                        'rgba(255, 99, 132, 0.6)'
                                    ],
                                    borderColor: [
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(255, 159, 64, 1)',
                                        'rgba(255, 99, 132, 1)'
                                    ],
                                    borderWidth: 1,
                                    borderRadius: 6
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'Número de funciones'
                                        },
                                        grid: {
                                            color: 'rgba(70, 70, 70, 0.3)'
                                        }
                                    },
                                    x: {
                                        grid: {
                                            color: 'rgba(70, 70, 70, 0.3)'
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                },
                                animation: {
                                    duration: 1500,
                                    easing: 'easeOutQuart'
                                }
                            }
                        });

                        // Mostrar estadísticas con animación
                        const complexityStats = document.getElementById('complexity-stats');
                        const stats = [
                            { label: 'Complejidad media:', value: '4.2' },
                            { label: 'Complejidad máxima:', value: '12' },
                            { label: 'Funciones analizadas:', value: '11' },
                            { label: 'Funciones complejas:', value: '3 (27%)' }
                        ];

                        complexityStats.innerHTML = '';
                        stats.forEach((stat, index) => {
                            const row = document.createElement('tr');
                            row.className = 'fade-in';
                            row.style.animationDelay = `${index * 100}ms`;
                            row.innerHTML = `<td>${stat.label}</td><td><span class="cyber-value">${stat.value}</span></td>`;
                            complexityStats.appendChild(row);
                        });

                        // Mostrar complejidad por función con animación
                        const functionsComplexity = document.getElementById('functions-complexity').querySelector('tbody');
                        const functions = [
                            { name: 'process_data()', complexity: 8, lines: 45, recommendation: 'Considerar dividir en funciones más pequeñas', badge: 'cyber-badge-warning' },
                            { name: 'calculate_metrics()', complexity: 12, lines: 78, recommendation: 'Refactorizar urgentemente', badge: 'cyber-badge-danger' },
                            { name: 'validate_input()', complexity: 7, lines: 32, recommendation: 'Simplificar condiciones', badge: 'cyber-badge-warning' },
                            { name: 'format_output()', complexity: 3, lines: 18, recommendation: 'Bien estructurada', badge: 'cyber-badge-success' }
                        ];

                        functionsComplexity.innerHTML = '';
                        functions.forEach((func, index) => {
                            const row = document.createElement('tr');
                            row.className = 'fade-in';
                            row.style.animationDelay = `${(index + stats.length) * 100}ms`;
                            row.innerHTML = `
                                <td>${func.name}</td>
                                <td><span class="cyber-badge ${func.badge}">${func.complexity}</span></td>
                                <td>${func.lines}</td>
                                <td>${func.recommendation}</td>
                            `;
                            functionsComplexity.appendChild(row);
                        });

                        setTimeout(() => {
                            complexityResults.classList.remove('fade-in');
                        }, 500);
                    }, 300);
                }, 500);
            }
            }, 50);
            });

            // Iniciar depuración mejorada con animaciones
            startDebugBtn.addEventListener('click', function() {
            const code = codeInput.value.trim();
            const language = codeLanguage.value;
            const error = errorMessage.value.trim();
            const checkSyntax = document.getElementById('check-syntax').checked;
            const checkLogic = document.getElementById('check-logic').checked;
            const checkPerformance = document.getElementById('check-performance').checked;
            const checkSecurity = document.getElementById('check-security').checked;

            if (!code) {
            showToast('Por favor, ingresa código para depurar', 'warning');
            return;
            }

            // Mostrar barra de progreso con animación
            progressBar.style.display = 'block';
            debugResult.style.display = 'none';
            startDebugBtn.disabled = true;
            startDebugBtn.innerHTML = '<span class="btn-content"><div class="btn-spinner"></div> Analizando...</span>';
            startDebugBtn.classList.add('btn-processing');

            // Simulación de progreso con animación
            let progress = 0;
            const interval = setInterval(() => {
            progress += 2;
            progressBarInner.style.width = `${progress}%`;
            progressBarInner.setAttribute('aria-valuenow', progress);

            // Añadir efecto de pulso en ciertos puntos
            if (progress % 25 === 0) {
                progressBarInner.classList.add('pulse');
                setTimeout(() => {
                    progressBarInner.classList.remove('pulse');
                }, 500);
            }

            if (progress >= 100) {
                clearInterval(interval);

                // Simulación de diagnóstico con animación
                setTimeout(() => {
                    // Análisis automático del código basado en las opciones seleccionadas
                    let diagnosis = '<h5 class="cyber-heading">Problemas detectados:</h5><ul class="cyber-list">';
                    let details = '<h5 class="cyber-heading">Detalles técnicos:</h5><ul class="cyber-list">';
                    let fixedCode = code;

                    // Verificar errores comunes según el lenguaje y las opciones seleccionadas
                    if (language === 'python') {
                        if (checkSyntax) {
                            // Ejemplo de corrección para Python
                            if (code.includes('print ')) {
                                diagnosis += '<li class="text-danger"><strong>Error de sintaxis:</strong> Uso de la función print sin paréntesis (estilo Python 2).</li>';
                                details += '<li><strong>SyntaxError:</strong> En Python 3, print es una función y requiere paréntesis. La sintaxis <code>print "texto"</code> es válida en Python 2 pero no en Python 3.</li>';
                                fixedCode = code.replace(/print\s+([^(].*$)/gm, 'print($1)');
                            }

                            if (code.includes('except') && code.includes(',')) {
                                diagnosis += '<li class="text-danger"><strong>Error de sintaxis:</strong> Uso de sintaxis antigua para excepciones.</li>';
                                details += '<li><strong>SyntaxError:</strong> La sintaxis <code>except ExceptionType, var</code> está obsoleta. Use <code>except ExceptionType as var</code> en su lugar.</li>';
                                fixedCode = code.replace(/except\s+(\w+)\s*,\s*(\w+)/g, 'except $1 as $2');
                            }
                        }

                        if (checkLogic) {
                            if (code.includes('range(len(') && code.includes('for i in range')) {
                                diagnosis += '<li class="text-warning"><strong>Problema lógico:</strong> Uso ineficiente de índices en bucles.</li>';
                                details += '<li><strong>Optimización:</strong> En lugar de <code>for i in range(len(lista))</code>, considere usar <code>for item in lista</code> o <code>for i, item in enumerate(lista)</code> si necesita el índice.</li>';
                            }
                        }

                        if (checkPerformance) {
                            if (code.includes('for') && code.includes('append')) {
                                diagnosis += '<li class="text-info"><strong>Problema de rendimiento:</strong> Posible uso de list comprehension.</li>';
                                details += '<li><strong>Optimización:</strong> Las list comprehensions son más eficientes que los bucles for con append. Considere reemplazar <code>result = []; for x in data: result.append(x)</code> con <code>result = [x for x in data]</code>.</li>';
                            }
                        }

                        if (checkSecurity) {
                            if (code.includes('eval(') || code.includes('exec(')) {
                                diagnosis += '<li class="text-danger"><strong>Vulnerabilidad de seguridad:</strong> Uso de eval() o exec().</li>';
                                details += '<li><strong>Riesgo crítico:</strong> Las funciones eval() y exec() pueden ejecutar código arbitrario y representan un riesgo de seguridad significativo. Evite su uso especialmente con entrada de usuario.</li>';
                            }
                        }
                    } else if (language === 'javascript') {
                        if (checkSyntax) {
                            if (code.includes('var ')) {
                                diagnosis += '<li class="text-warning"><strong>Sintaxis obsoleta:</strong> Uso de "var" para declaración de variables.</li>';
                                details += '<li><strong>Modernización:</strong> Se recomienda usar "let" o "const" en lugar de "var" para la declaración de variables en JavaScript moderno.</li>';
                                fixedCode = code.replace(/var\s+(\w+)/g, 'let $1');
                            }

                            if (code.includes('==') && !code.includes('===')) {
                                diagnosis += '<li class="text-warning"><strong>Problema potencial:</strong> Uso de operador de igualdad débil (==).</li>';
                                details += '<li><strong>Buena práctica:</strong> El operador == puede causar conversiones de tipo inesperadas. Considere usar === para comparaciones estrictas.</li>';
                            }
                        }

                        if (checkLogic) {
                            if (code.includes('if') && code.match(/if\s*\(\s*\w+\s*=\s*\w+/)) {
                                diagnosis += '<li class="text-danger"><strong>Error lógico:</strong> Posible asignación en lugar de comparación.</li>';
                                details += '<li><strong>Error común:</strong> Se detectó una asignación (=) dentro de una condición if. Probablemente quería usar una comparación (== o ===).</li>';
                                fixedCode = code.replace(/if\s*\(\s*(\w+)\s*=\s*(\w+)/g, 'if ($1 === $2');
                            }
                        }

                        if (checkPerformance) {
                            if ((code.includes('for (') && code.includes('length')) || code.includes('for (let i = 0')) {
                                diagnosis += '<li class="text-info"><strong>Mejora de rendimiento:</strong> Optimización de bucles.</li>';
                                details += '<li><strong>Modernización:</strong> Para arrays, considere usar métodos como forEach, map, filter o reduce en lugar de bucles for tradicionales.</li>';
                            }
                        }

                        if (checkSecurity) {
                            if (code.includes('innerHTML') || code.includes('document.write')) {
                                diagnosis += '<li class="text-danger"><strong>Vulnerabilidad XSS:</strong> Uso inseguro de innerHTML o document.write.</li>';
                                details += '<li><strong>Riesgo de seguridad:</strong> Usar innerHTML o document.write con datos no validados puede permitir ataques XSS. Considere usar textContent o métodos DOM seguros.</li>';
                            }
                        }
                    }

                    // Si hay un mensaje de error específico, analizarlo
                    if (error) {
                        diagnosis = `<div class="cyber-alert cyber-alert-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i><strong>Error reportado:</strong> ${error}</div>` + diagnosis;

                        // Intentar interpretar el error
                        if (error.includes('SyntaxError')) {
                            details += '<li><strong>SyntaxError</strong> indica un problema con la estructura del código que impide su ejecución.</li>';
                        } else if (error.includes('TypeError')) {
                            details += '<li><strong>TypeError</strong> ocurre cuando una operación se intenta realizar en un tipo de dato incorrecto.</li>';
                        } else if (error.includes('ReferenceError')) {
                            details += '<li><strong>ReferenceError</strong> indica que se está intentando acceder a una variable o función que no existe o no está en el ámbito actual.</li>';
                        }
                    }

                    diagnosis += '</ul>';
                    details += '</ul>';

                    // Si no se encontraron problemas
                    if (diagnosis === '<h5 class="cyber-heading">Problemas detectados:</h5><ul class="cyber-list"></ul>') {
                        diagnosis = '<div class="cyber-alert cyber-alert-success"><i class="bi bi-check-circle-fill me-2"></i>No se detectaron problemas significativos en el código.</div>';
                    }

                    // Mostrar resultados con animación
                    progressBar.classList.add('fade-out');
                    setTimeout(() => {
                        progressBar.style.display = 'none';
                        progressBar.classList.remove('fade-out');

                        debugDiagnosis.innerHTML = diagnosis;
                        debugDetails.innerHTML = details;
                        debugFix.textContent = fixedCode;
                        debugFix.className = `language-${language}`;
                        hljs.highlightElement(debugFix);

                        debugResult.style.display = 'block';
                        debugResult.classList.add('fade-in');

                        startDebugBtn.disabled = false;
                        startDebugBtn.classList.remove('btn-processing');
                        startDebugBtn.innerHTML = '<span class="btn-content"><i class="bi bi-play-fill"></i> Iniciar análisis</span>';

                        setTimeout(() => {
                            debugResult.classList.remove('fade-in');
                        }, 500);
                    }, 300);
                }, 500);
            }
            }, 50);
            });

            // Aplicar corrección de depuración al editor con animación
            applyDebugFixBtn.addEventListener('click', function() {
            applyDebugFixBtn.innerHTML = '<span class="btn-content"><div class="btn-spinner"></div> Aplicando...</span>';
            applyDebugFixBtn.disabled = true;

            setTimeout(() => {
            codeInput.classList.add('fade-out');
            setTimeout(() => {
                codeInput.value = debugFix.textContent;
                codeInput.classList.remove('fade-out');
                codeInput.classList.add('fade-in');

                setTimeout(() => {
                    codeInput.classList.remove('fade-in');
                    debugModal.hide();
                    showToast('Solución aplicada al editor', 'success');
                    applyDebugFixBtn.innerHTML = '<span class="btn-content"><i class="bi bi-check-lg"></i> Aplicar solución</span>';
                    applyDebugFixBtn.disabled = false;
                }, 300);
            }, 300);
            }, 500);
            });

            // Copiar código corregido con animación
            copyBtn.addEventListener('click', function() {
            const code = correctedCode.textContent;

            copyBtn.innerHTML = '<i class="bi bi-clipboard-check"></i> Copiando...';
            copyBtn.disabled = true;

            navigator.clipboard.writeText(code)
            .then(() => {
                copyBtn.innerHTML = '<i class="bi bi-clipboard-check"></i> ¡Copiado!';

                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="bi bi-clipboard"></i> Copiar';
                    copyBtn.disabled = false;
                    showToast('Código copiado al portapapeles', 'success');
                }, 1000);
            })
            .catch(err => {
                console.error('Error al copiar:', err);
                copyBtn.innerHTML = '<i class="bi bi-clipboard-x"></i> Error';

                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="bi bi-clipboard"></i> Copiar';
                    copyBtn.disabled = false;
                    showToast('No se pudo copiar el código', 'error');
                }, 1000);
            });
            });

            // Aplicar corrección al editor con animación avanzada
            applyFixBtn.addEventListener('click', function() {
            const originalCode = codeInput.value;
            const newCode = correctedCode.textContent;

            applyFixBtn.innerHTML = '<i class="bi bi-magic"></i> Aplicando...';
            applyFixBtn.disabled = true;

            // Animación avanzada de transición
            resultsContainer.classList.add('slide-down');
            codeInput.classList.add('cyber-glow');

            setTimeout(() => {
            resultsContainer.style.display = 'none';
            resultsContainer.classList.remove('slide-down');

            codeInput.classList.add('fade-out');
            setTimeout(() => {
                codeInput.value = newCode;
                codeInput.classList.remove('fade-out');
                codeInput.classList.add('fade-in');

                setTimeout(() => {
                    codeInput.classList.remove('fade-in', 'cyber-glow');
                    applyFixBtn.innerHTML = '<i class="bi bi-magic"></i> Aplicar corrección';
                    applyFixBtn.disabled = false;

                    showToast('Corrección aplicada al editor', 'success');

                    // Desplazarse al editor con animación
                    codeInput.scrollIntoView({ behavior: 'smooth' });
                    codeInput.focus();
                }, 300);
            }, 300);
            }, 300);
            });

            // Descargar código corregido con animación
            downloadBtn.addEventListener('click', function() {
            const code = correctedCode.textContent;
            const language = codeLanguage.value;

            downloadBtn.innerHTML = '<i class="bi bi-cloud-download"></i> Descargando...';
            downloadBtn.disabled = true;

            // Determinar extensión de archivo según lenguaje
            const extensions = {
            'python': 'py',
            'javascript': 'js',
            'typescript': 'ts',
            'java': 'java',
            'cpp': 'cpp',
            'csharp': 'cs',
            'php': 'php',
            'ruby': 'rb',
            'go': 'go',
            'swift': 'swift',
            'kotlin': 'kt',
            'rust': 'rs',
            'html': 'html',
            'css': 'css',
            'sql': 'sql'
            };

            const extension = extensions[language] || 'txt';
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const filename = `codigo_corregido_${timestamp}.${extension}`;

            // Crear blob y descargar con animación
            setTimeout(() => {
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();

            // Liberar URL
            setTimeout(() => URL.revokeObjectURL(url), 100);

            downloadBtn.innerHTML = '<i class="bi bi-check-circle"></i> ¡Descargado!';

            setTimeout(() => {
                downloadBtn.innerHTML = '<i class="bi bi-download"></i> Descargar';
                downloadBtn.disabled = false;
                showToast(`Archivo guardado como ${filename}`, 'success');
            }, 1000);
            }, 500);
            });

            // Explicar código con animación
            explainCodeBtn.addEventListener('click', function() {
            const code = codeInput.value.trim();
            const language = codeLanguage.value;

            if (!code) {
            showToast('Por favor, ingresa código para explicar', 'warning');
            return;
            }

            showToast('Analizando código...', 'info');

            // Mostrar efecto de procesamiento en el editor
            codeInput.classList.add('processing');

            // En una aplicación real, esto sería una llamada al backend
            setTimeout(() => {
            codeInput.classList.remove('processing');

            // Procesar código y mostrar resultados con animación
            if (resultsContainer.style.display !== 'none') {
                resultsContainer.classList.add('slide-down');
                setTimeout(() => {
                    resultsContainer.style.display = 'none';
                    resultsContainer.classList.remove('slide-down');
                    showExplanation();
                }, 300);
            } else {
                showExplanation();
            }

            function showExplanation() {
                resultsContainer.style.display = 'block';
                resultsContainer.classList.add('slide-up');

                // Mostrar solo la pestaña de explicación
                document.getElementById('explanation-tab').click();

                // Generar explicación con animación
                explanationText.innerHTML = '';
                explanationText.classList.add('typing-effect');

                const explanation = marked.parse(`
            # Explicación del Código

            Este código parece ser ${getLanguageDescription(language)}. Vamos a analizarlo por partes:

            ## Estructura general

            El código está organizado de la siguiente manera:
            - Importación de bibliotecas/módulos
            - Definición de funciones/clases
            - Lógica principal del programa

            ## Componentes principales

            1. **Funciones principales**: El código define varias funciones que manejan diferentes aspectos de la lógica del programa.
            2. **Manejo de datos**: Se observa procesamiento de datos con estructuras como ${getDataStructures(language)}.
            3. **Control de flujo**: Utiliza estructuras de control como condicionales y bucles para dirigir la ejecución del programa.

            ## Fortalezas del código

            - Estructura lógica clara
            - Nombres de variables descriptivos
            - Manejo adecuado de casos de error

            ## Áreas de mejora potenciales

            - Algunas secciones podrían beneficiarse de comentarios adicionales
            - Considerar la modularización de funciones extensas
            - Implementar manejo de excepciones más robusto

            ## Resumen

            Este código implementa una solución para ${getPossiblePurpose(language, code)} utilizando técnicas estándar de ${language}. La estructura general es sólida, aunque hay oportunidades para mejorar la legibilidad y mantenibilidad.
                `);

                // Simular efecto de escritura
                setTimeout(() => {
                    explanationText.innerHTML = explanation;
                    explanationText.classList.remove('typing-effect');
                    explanationText.classList.add('fade-in');

                    setTimeout(() => {
                        explanationText.classList.remove('fade-in');
                        resultsContainer.classList.remove('slide-up');
                    }, 500);

                    // Desplazarse a los resultados con animación suave
                    resultsContainer.scrollIntoView({ behavior: 'smooth' });
                }, 800);
            }
            }, 1500);
            });

            // Funciones auxiliares para la explicación del código
            function getLanguageDescription(language) {
            const descriptions = {
            'python': 'un script de Python, posiblemente para procesamiento de datos o automatización',
            'javascript': 'un programa JavaScript, probablemente para funcionalidad web o interacción con el DOM',
            'typescript': 'una aplicación TypeScript con tipado estático',
            'java': 'una clase Java con orientación a objetos',
            'cpp': 'un programa C++ con manejo de memoria y rendimiento optimizado',
            'csharp': 'una aplicación C# basada en .NET',
            'php': 'un script PHP para procesamiento web del lado del servidor',
            'ruby': 'un script Ruby con sintaxis elegante y enfoque en productividad',
            'go': 'un programa Go con concurrencia y rendimiento eficiente',
            'swift': 'una aplicación Swift para el ecosistema Apple',
            'kotlin': 'código Kotlin moderno para desarrollo Android o multiplataforma',
            'rust': 'un programa Rust con seguridad de memoria y rendimiento',
            'html': 'una estructura HTML para contenido web',
            'css': 'una hoja de estilos CSS para presentación web',
            'sql': 'consultas SQL para interacción con bases de datos'
            };

            return descriptions[language] || 'un programa de computadora';
            }

            function getDataStructures(language) {
            const structures = {
            'python': 'listas, diccionarios y conjuntos',
            'javascript': 'arrays, objetos y Maps',
            'typescript': 'arrays tipados, interfaces y clases',
            'java': 'ArrayList, HashMap y clases personalizadas',
            'cpp': 'vectores, mapas y estructuras personalizadas',
            'csharp': 'List<T>, Dictionary<K,V> y clases POCO',
            'php': 'arrays asociativos y objetos',
            'ruby': 'arrays, hashes y objetos',
            'go': 'slices, maps y structs',
            'swift': 'Arrays, Dictionaries y structs',
            'kotlin': 'Lists, Maps y data classes',
            'rust': 'Vectors, HashMaps y structs',
            'sql': 'tablas y relaciones'
            };

            return structures[language] || 'estructuras de datos comunes';
            }

            function getPossiblePurpose(language, code) {
            // Análisis simple basado en palabras clave
            if (code.includes('fetch') || code.includes('axios') || code.includes('http')) {
            return 'comunicación con APIs o servicios web';
            } else if (code.includes('select') && code.includes('from')) {
            return 'consultas a bases de datos';
            } else if (code.includes('class') && code.includes('extends')) {
            return 'implementación de un sistema orientado a objetos con herencia';
            } else if (code.includes('function') || code.includes('def ')) {
            return 'procesamiento de datos mediante funciones modulares';
            } else if (code.includes('<div') || code.includes('<span')) {
            return 'renderizado de interfaces de usuario';
            } else {
            return 'procesamiento de datos o automatización de tareas';
            }
            }

            // Cambiar sintaxis de highlight.js cuando cambia el lenguaje con animación
            codeLanguage.addEventListener('change', function() {
            const language = codeLanguage.value;

            if (correctedCode.textContent) {
            correctedCode.classList.add('fade-out');
            setTimeout(() => {
                correctedCode.className = `language-${language}`;
                hljs.highlightElement(correctedCode);
                correctedCode.classList.remove('fade-out');
                correctedCode.classList.add('fade-in');
                setTimeout(() => {
                    correctedCode.classList.remove('fade-in');
                }, 300);
            }, 300);
            } else {
            correctedCode.className = `language-${language}`;
            }
            });

            // Verificar seguridad con animación
            securityCheckBtn.addEventListener('click', function() {
            const code = codeInput.value.trim();
            const language = codeLanguage.value;

                if (!code) {
                    showToast('Por favor, ingresa código para verificar', 'warning');
                    return;
                }

                showToast('Analizando vulnerabilidades...', 'info');

                // Mostrar efecto de escaneo en el editor
                codeInput.classList.add('scanning');

                // En una aplicación real, esto sería una llamada al backend
                setTimeout(() => {
                    codeInput.classList.remove('scanning');

                    // Análisis simple basado en patrones conocidos
                    const vulnerabilities = [];

                    if (language === 'python') {
                        if (code.includes('eval(') || code.includes('exec(')) {
                            vulnerabilities.push({
                                severity: 'alta',
                                type: 'Ejecución de código',
                                description: 'Uso de eval() o exec() que puede permitir ejecución de código arbitrario',
                                recommendation: 'Evitar el uso de eval() y exec(), especialmente con entrada de usuario'
                            });
                        }

                        if (code.includes('os.system(') || code.includes('subprocess')) {
                            vulnerabilities.push({
                                severity: 'alta',
                                type: 'Inyección de comandos',
                                description: 'Ejecución de comandos del sistema que podría ser vulnerable a inyección',
                                recommendation: 'Usar subprocess.run() con shell=False y validar cuidadosamente las entradas'
                            });
                        }

                        if (code.includes('pickle.load') || code.includes('marshal.load')) {
                            vulnerabilities.push({
                                severity: 'alta',
                                type: 'Deserialización insegura',
                                description: 'Deserialización de datos que puede permitir ejecución de código arbitrario',
                                recommendation: 'Usar formatos seguros como JSON en lugar de pickle o marshal'
                            });
                        }
                    } else if (language === 'javascript') {
                        if (code.includes('eval(') || code.includes('new Function(')) {
                            vulnerabilities.push({
                                severity: 'alta',
                                type: 'Ejecución de código',
                                description: 'Uso de eval() o Function constructor que puede permitir ejecución de código arbitrario',
                                recommendation: 'Evitar el uso de eval() y new Function(), usar alternativas más seguras'
                            });
                        }

                        if (code.includes('innerHTML') || code.includes('document.write')) {
                            vulnerabilities.push({
                                severity: 'media',
                                type: 'Cross-Site Scripting (XSS)',
                                description: 'Manipulación del DOM que podría permitir ataques XSS',
                                recommendation: 'Usar textContent en lugar de innerHTML, o implementar sanitización de HTML'
                            });
                        }

                        if (code.includes('localStorage') && !code.includes('httpOnly')) {
                            vulnerabilities.push({
                                severity: 'baja',
                                type: 'Almacenamiento inseguro',
                                description: 'Uso de localStorage para datos potencialmente sensibles',
                                recommendation: 'No almacenar datos sensibles en localStorage, usar cookies HttpOnly para sesiones'
                            });
                        }
                    }

                    // Mostrar resultados con animación
                    if (resultsContainer.style.display !== 'none') {
                        resultsContainer.classList.add('slide-down');
                        setTimeout(() => {
                            resultsContainer.style.display = 'none';
                            resultsContainer.classList.remove('slide-down');
                            showSecurityReport();
                        }, 300);
                    } else {
                        showSecurityReport();
                    }

                    function showSecurityReport() {
                        resultsContainer.style.display = 'block';
                        resultsContainer.classList.add('slide-up');

                        // Mostrar la pestaña de explicación
                        document.getElementById('explanation-tab').click();

                        // Generar informe de seguridad
                        let securityReport = '';

                        if (vulnerabilities.length > 0) {
                            securityReport = `
                # <i class="bi bi-shield-exclamation me-2"></i>Informe de Seguridad

                Se han detectado **${vulnerabilities.length} posibles vulnerabilidades** en el código analizado:

                `;

                            vulnerabilities.forEach((vuln, index) => {
                                const severityBadge = vuln.severity === 'alta' ? '🔴 ALTA' :
                                                    vuln.severity === 'media' ? '🟠 MEDIA' : '🟡 BAJA';

                                securityReport += `## ${index + 1}. ${vuln.type} (${severityBadge})

                **Descripción:** ${vuln.description}

                **Recomendación:** ${vuln.recommendation}

                ---

                `;
                            });

                            securityReport += `
                ## <i class="bi bi-lightbulb me-2"></i>Recomendaciones generales

                1. Validar todas las entradas de usuario
                2. Implementar el principio de privilegio mínimo
                3. Mantener las dependencias actualizadas
                4. Implementar logging adecuado para detectar actividades sospechosas
                `;
                        } else {
                            securityReport = `
                # <i class="bi bi-shield-check me-2"></i>Informe de Seguridad

                ✅ **No se detectaron vulnerabilidades evidentes** en el código analizado.

                Esto no garantiza que el código esté completamente libre de problemas de seguridad. Algunas recomendaciones generales:

                1. Validar todas las entradas de usuario
                2. Implementar el principio de privilegio mínimo
                3. Mantener las dependencias actualizadas
                4. Considerar una revisión manual de seguridad para código crítico
                `;
                        }

                        // Mostrar resultados con efecto de escritura
                        explanationText.innerHTML = '';
                        explanationText.classList.add('typing-effect');

                        setTimeout(() => {
                            explanationText.innerHTML = marked.parse(securityReport);
                            explanationText.classList.remove('typing-effect');
                            explanationText.classList.add('fade-in');

                            setTimeout(() => {
                                explanationText.classList.remove('fade-in');
                                resultsContainer.classList.remove('slide-up');
                            }, 500);

                            // Desplazarse a los resultados con animación suave
                            resultsContainer.scrollIntoView({ behavior: 'smooth' });
                        }, 800);
                    }
                }, 2000);
                });

                // Generar tests con animación
                generateTestsBtn.addEventListener('click', function() {
                const code = codeInput.value.trim();
                const language = codeLanguage.value;

                if (!code) {
                    showToast('Por favor, ingresa código para generar tests', 'warning');
                    return;
                }

                showToast('Generando tests...', 'info');

                // Mostrar efecto de procesamiento en el editor
                codeInput.classList.add('processing');

                // En una aplicación real, esto sería una llamada al backend
                setTimeout(() => {
                    codeInput.classList.remove('processing');

                    // Generar tests basados en el lenguaje
                    let testCode = '';
                    let explanation = '';

                    if (language === 'python') {
                        testCode = `import unittest
                from your_module import *  # Importar las funciones/clases a probar

                class TestYourCode(unittest.TestCase):

                def setUp(self):
                # Configuración que se ejecuta antes de cada test
                self.test_data = [1, 2, 3, 4, 5]

                def test_function_returns_expected_result(self):
                # Prueba que la función devuelve el resultado esperado
                result = your_function(self.test_data)
                self.assertEqual(result, expected_result)

                def test_handles_empty_input(self):
                # Prueba que la función maneja correctamente entradas vacías
                result = your_function([])
                self.assertEqual(result, expected_empty_result)

                def test_raises_exception_for_invalid_input(self):
                # Prueba que la función lanza excepciones apropiadas
                with self.assertRaises(ValueError):
                    your_function(None)

                def tearDown(self):
                # Limpieza después de cada test
                pass

                if __name__ == '__main__':
                unittest.main()`;

                        explanation = `
                # <i class="bi bi-check2-circle me-2"></i>Tests Generados para Python

                He generado un esqueleto de tests unitarios usando el framework **unittest** de Python. Estos tests están diseñados para verificar:

                1. **Resultados esperados**: Verificar que la función devuelve los valores correctos para entradas válidas
                2. **Manejo de casos límite**: Comprobar que el código maneja correctamente entradas vacías
                3. **Manejo de excepciones**: Asegurar que se lanzan las excepciones apropiadas para entradas inválidas

                ## <i class="bi bi-question-circle me-2"></i>Cómo usar estos tests

                1. Guarda el código de test en un archivo (por ejemplo, \`test_your_module.py\`)
                2. Reemplaza \`your_module\` con el nombre real de tu módulo
                3. Reemplaza \`your_function\` con el nombre de la función que quieres probar
                4. Define los valores esperados (\`expected_result\` y \`expected_empty_result\`)
                5. Ejecuta los tests con \`python -m unittest test_your_module.py\`

                ## <i class="bi bi-stars me-2"></i>Mejores prácticas

                - **Aislamiento**: Cada test debe ser independiente de los demás
                - **Cobertura**: Intenta cubrir todos los caminos de ejecución posibles
                - **Claridad**: Usa nombres descriptivos para los tests
                - **Mantenibilidad**: Actualiza los tests cuando cambies el código

                Puedes expandir estos tests para cubrir más casos y funcionalidades específicas de tu código.
                `;
                    } else if (language === 'javascript') {
                        testCode = `// Usando Jest como framework de testing
                const { yourFunction } = require('./your-module');

                describe('Your Module Tests', () => {
                let testData;

                beforeEach(() => {
                // Setup que se ejecuta antes de cada test
                testData = [1, 2, 3, 4, 5];
                });

                test('function returns expected result', () => {
                const result = yourFunction(testData);
                expect(result).toBe(expectedResult);
                });

                test('handles empty input correctly', () => {
                const result = yourFunction([]);
                expect(result).toBe(expectedEmptyResult);
                });

                test('throws error for invalid input', () => {
                expect(() => {
                yourFunction(null);
                }).toThrow();
                });

                afterEach(() => {
                // Cleanup después de cada test
                });
                });`;

                        explanation = `
                # <i class="bi bi-check2-circle me-2"></i>Tests Generados para JavaScript

                He generado un esqueleto de tests unitarios usando **Jest**, un popular framework de testing para JavaScript. Estos tests están diseñados para verificar:

                1. **Resultados esperados**: Comprobar que la función devuelve los valores correctos
                2. **Manejo de casos límite**: Verificar el comportamiento con arrays vacíos
                3. **Manejo de errores**: Asegurar que se lanzan errores apropiados para entradas inválidas

                ## <i class="bi bi-question-circle me-2"></i>Cómo usar estos tests

                1. Instala Jest: \`npm install --save-dev jest\`
                2. Guarda el código de test en un archivo (por ejemplo, \`your-module.test.js\`)
                3. Reemplaza \`your-module\` con el nombre real de tu módulo
                4. Reemplaza \`yourFunction\` con el nombre de la función que quieres probar
                5. Define los valores esperados (\`expectedResult\` y \`expectedEmptyResult\`)
                6. Ejecuta los tests con \`npx jest\`

                ## <i class="bi bi-gear me-2"></i>Configuración en package.json

                Añade esto a tu package.json:

                \`\`\`json
                {
                "scripts": {
                "test": "jest"
                }
                }
                \`\`\`

                Luego podrás ejecutar los tests con \`npm test\`.

                ## <i class="bi bi-stars me-2"></i>Mejores prácticas

                - **Tests atómicos**: Cada test debe probar una sola cosa
                - **Mocks**: Usa mocks para dependencias externas
                - **Asincronía**: Para funciones asíncronas, usa async/await o retorna promesas
                - **Snapshots**: Considera usar snapshots para componentes UI

                Puedes expandir estos tests según las necesidades específicas de tu código.
                `;
                    }

                    // Mostrar resultados con animación
                    if (resultsContainer.style.display !== 'none') {
                        resultsContainer.classList.add('slide-down');
                        setTimeout(() => {
                            resultsContainer.style.display = 'none';
                            resultsContainer.classList.remove('slide-down');
                            showTestResults();
                        }, 300);
                    } else {
                        showTestResults();
                    }

                    function showTestResults() {
                        resultsContainer.style.display = 'block';
                        resultsContainer.classList.add('slide-up');

                        // Mostrar código de test y explicación
                        document.getElementById('explanation-tab').click();

                        explanationText.innerHTML = '';
                        explanationText.classList.add('typing-effect');

                        setTimeout(() => {
                            explanationText.innerHTML = marked.parse(explanation);
                            explanationText.classList.remove('typing-effect');
                            explanationText.classList.add('fade-in');

                            // Mostrar código de test en la pestaña de código
                            correctedCode.textContent = testCode;
                            correctedCode.className = `language-${language}`;
                            hljs.highlightElement(correctedCode);

                            setTimeout(() => {
                                explanationText.classList.remove('fade-in');
                                resultsContainer.classList.remove('slide-up');
                            }, 500);

                            // Desplazarse a los resultados con animación suave
                            resultsContainer.scrollIntoView({ behavior: 'smooth' });
                        }, 800);
                    }
                }, 2000);
                });

                // Inicializar efectos para inputs y botones
                document.querySelectorAll('.cyber-editor').forEach(editor => {
                editor.addEventListener('focus', () => {
                    editor.parentElement.classList.add('editor-focus');
                });

                editor.addEventListener('blur', () => {
                    editor.parentElement.classList.remove('editor-focus');
                });
                });

                // Añadir efectos hover a botones
                document.querySelectorAll('.btn-cyber-primary, .btn-cyber-secondary, .btn-cyber-success, .btn-cyber-light, .btn-cyber-dark').forEach(btn => {
                btn.addEventListener('mouseover', () => {
                    btn.classList.add('btn-hover');
                });

                btn.addEventListener('mouseout', () => {
                    btn.classList.remove('btn-hover');
                });

                btn.addEventListener('mousedown', () => {
                    btn.classList.add('btn-active');
                });

                btn.addEventListener('mouseup', () => {
                    btn.classList.remove('btn-active');
                });
                });

                // Efecto de partículas para botones principales
                document.querySelectorAll('.btn-cyber-primary').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (!btn.disabled) {
                        const rect = btn.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;

                        const particles = document.createElement('div');
                        particles.className = 'particles';
                        particles.style.left = `${x}px`;
                        particles.style.top = `${y}px`;
                        btn.appendChild(particles);

                        setTimeout(() => {
                            particles.remove();
                        }, 1000);
                    }
                });
                });
                });
                </script>
                {% endblock %}

                {% block extra_css %}
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
                <style>
                /* Tema futurista con neón y glassmorphism */
                :root {
                --primary-color: #0ff;
                --primary-glow: 0 0 10px rgba(0, 255, 255, 0.7);
                --secondary-color: #ff00ff;
                --secondary-glow: 0 0 10px rgba(255, 0, 255, 0.7);
                --success-color: #00ff9d;
                --success-glow: 0 0 10px rgba(0, 255, 157, 0.7);
                --warning-color: #ffb700;
                --warning-glow: 0 0 10px rgba(255, 183, 0, 0.7);
                --danger-color: #ff2e6e;
                --danger-glow: 0 0 10px rgba(255, 46, 110, 0.7);
                --dark-bg: #0a0b14;
                --card-bg: rgba(25, 28, 39, 0.7);
                --card-border: rgba(79, 195, 247, 0.2);
                --text-color: #e0e0ff;
                --text-secondary: #a0a0d0;
                --border-radius: 8px;
                --glass-effect: blur(10px);
                --gradient-primary: linear-gradient(135deg, #0ff, #0088ff);
                --gradient-success: linear-gradient(135deg, #00ff9d, #00c8ff);
                --gradient-dark: linear-gradient(135deg, #2a2d3e, #1a1c25);
                }

                /* Estilos generales futuristas */
                body {
                background-color: var(--dark-bg);
                background-image: 
                    radial-gradient(circle at 10% 10%, rgba(0, 255, 255, 0.05) 0%, transparent 30%),
                    radial-gradient(circle at 90% 90%, rgba(255, 0, 255, 0.05) 0%, transparent 30%),
                    linear-gradient(to bottom, #0a0b14, #141725);
                color: var(--text-color);
                font-family: 'Orbitron', 'JetBrains Mono', 'Fira Code', monospace;
                line-height: 1.6;
                min-height: 100vh;
                position: relative;
                overflow-x: hidden;
                }

                /* Tarjetas con efecto glassmorphism */
                .glass-card {
                background: var(--card-bg);
                border-radius: var(--border-radius);
                border: 1px solid var(--card-border);
                backdrop-filter: var(--glass-effect);
                -webkit-backdrop-filter: var(--glass-effect);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                overflow: hidden;
                margin-bottom: 1.5rem;
                }

                .glass-card:hover {
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4), 0 0 10px rgba(79, 195, 247, 0.2);
                transform: translateY(-2px);
                }

                /* Cabeceras con gradientes */
                .card-header-gradient {
                background: var(--gradient-primary);
                color: #fff;
                padding: 1rem;
                border-bottom: none;
                display: flex;
                align-items: center;
                position: relative;
                overflow: hidden;
                }

                .card-header-gradient::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                transform: translateX(-100%);
                animation: shimmer 3s infinite;
                }

                .card-header-gradient-success {
                background: var(--gradient-success);
                color: #fff;
                padding: 1rem;
                border-bottom: none;
                display: flex;
                align-items: center;
                position: relative;
                overflow: hidden;
                }

                .card-header-gradient-success::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                transform: translateX(-100%);
                animation: shimmer 3s infinite;
                }

                .card-header-mini {
                background: rgba(41, 50, 65, 0.7);
                color: var(--text-color);
                padding: 0.75rem 1rem;
                border-bottom: 1px solid rgba(79, 195, 247, 0.2);
                font-weight: 500;
                display: flex;
                align-items: center;
                }

                /* Animación de brillo para cabeceras */
                @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
                }

                /* Badge con efecto neón */
                .neon-badge {
                background: rgba(0, 0, 0, 0.3);
                color: var(--primary-color);
                border: 1px solid var(--primary-color);
                border-radius: 20px;
                padding: 0.4rem 1rem;
                font-size: 0.8rem;
                text-shadow: 0 0 5px var(--primary-color);
                box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
                transition: all 0.3s ease;
                }

                .neon-badge:hover {
                box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
                }

                /* Animación de pulso para badge */
                .pulse {
                animation: pulse 2s infinite;
                }

                @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(0, 255, 255, 0); }
                100% { box-shadow: 0 0 0 0 rgba(0, 255, 255, 0); }
                }

                /* Animación para actualización de badge */
                .badge-update {
                animation: badge-update 0.3s ease;
                }

                @keyframes badge-update {
                0% { transform: scale(1); opacity: 1; }
                50% { transform: scale(0.8); opacity: 0.5; }
                100% { transform: scale(1); opacity: 1; }
                }

                /* Textos con brillo */
                .glow-text {
                color: var(--primary-color);
                text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                font-weight: 500;
                letter-spacing: 0.5px;
                }

                /* Alerta con estilo futurista */
                .alert-cyber {
                background: rgba(25, 28, 39, 0.7);
                border-left: 4px solid var(--primary-color);
                border-radius: var(--border-radius);
                padding: 1rem;
                margin-bottom: 1.5rem;
                display: flex;
                align-items: flex-start;
                box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
                }

                .alert-icon {
                font-size: 1.5rem;
                color: var(--primary-color);
                margin-right: 1rem;
                text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                }

                .alert-content {
                flex: 1;
                }

                /* Selects con estilo futurista */
                .select-wrapper {
                position: relative;
                }

                .cyber-select {
                background: rgba(20, 23, 34, 0.7);
                border: 1px solid rgba(79, 195, 247, 0.3);
                border-radius: var(--border-radius);
                color: var(--text-color);
                padding: 0.6rem 1rem;
                appearance: none;
                transition: all 0.3s ease;
                box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
                width: 100%;
                }

                .cyber-select:focus {
                border-color: var(--primary-color);
                box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2), inset 0 0 5px rgba(0, 0, 0, 0.2);
                outline: none;
                }

                .select-arrow {
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--primary-color);
                pointer-events: none;
                transition: all 0.3s ease;
                }

                .cyber-select:focus + .select-arrow {
                transform: translateY(-50%) rotate(180deg);
                }

                /* Editor de código con estilo futurista */
                .code-editor-container {
                position: relative;
                border-radius: var(--border-radius);
                overflow: hidden;
                margin-bottom: 1rem;
                }

                .cyber-editor {
                background: rgba(15, 17, 26, 0.9);
                border: 1px solid rgba(79, 195, 247, 0.3);
                border-radius: var(--border-radius);
                color: var(--text-color);
                font-family: 'JetBrains Mono', 'Fira Code', monospace;
                font-size: 0.95rem;
                line-height: 1.6;
                padding: 1rem;
                resize: vertical;
                width: 100%;
                transition: all 0.3s ease;
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
                }

                .cyber-editor:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2), inset 0 0 10px rgba(0, 0, 0, 0.3);
                }

                .editor-focus {
                position: relative;
                }

                .editor-focus::after {
                content: '';
                position: absolute;
                top: -2px;
                left: -2px;
                right: -2px;
                bottom: -2px;
                border-radius: calc(var(--border-radius) + 2px);
                background: linear-gradient(45deg, var(--primary-color), transparent, var(--primary-color));
                background-size: 400% 400%;
                z-index: -1;
                animation: gradient-border 3s ease infinite;
                }

                @keyframes gradient-border {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
                }

                .editor-glow {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                pointer-events: none;
                border-radius: var(--border-radius);
                box-shadow: inset 0 0 20px rgba(0, 255, 255, 0.1);
                }

                /* Efecto de procesamiento para el editor */
                .processing {
                background-image: linear-gradient(90deg, rgba(15, 17, 26, 0.9) 0%, rgba(20, 23, 34, 0.9) 50%, rgba(15, 17, 26, 0.9) 100%);
                background-size: 200% 100%;
                animation: processing-bg 1.5s infinite;
                }

                @keyframes processing-bg {
                0% { background-position: 100% 0; }
                100% { background-position: -100% 0; }
                }

                /* Efecto de escaneo para análisis de seguridad */
                .scanning {
                position: relative;
                }

                .scanning::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 5px;
                background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
                animation: scanning 2s linear infinite;
                }

                @keyframes scanning {
                0% { top: 0; }
                100% { top: 100%; }
                }

                /* Botones con estilo futurista */
                .btn-cyber-primary, .btn-cyber-secondary, .btn-cyber-success, .btn-cyber-light, .btn-cyber-dark, .btn-cyber-outline, .btn-cyber-outline-sm {
                position: relative;
                border: none;
                border-radius: var(--border-radius);
                padding: 0.6rem 1.2rem;
                font-weight: 500;
                letter-spacing: 0.5px;
                text-transform: uppercase;
                overflow: hidden;
                transition: all 0.3s ease;
                z-index: 1;
                }

                .btn-cyber-primary {
                background: var(--gradient-primary);
                color: #fff;
                box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
                }

                .btn-cyber-secondary {
                background:
                    .btn-cyber-secondary {
                        background: linear-gradient(135deg, #7928ca, #ff0080);
                        color: #fff;
                        box-shadow: 0 0 15px rgba(255, 0, 128, 0.3);
                    }

                    .btn-cyber-success {
                        background: var(--gradient-success);
                        color: #fff;
                        box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
                    }

                    .btn-cyber-light {
                        background: rgba(255, 255, 255, 0.1);
                        color: var(--text-color);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                    }

                    .btn-cyber-dark {
                        background: var(--gradient-dark);
                        color: var(--text-color);
                        border: 1px solid rgba(79, 195, 247, 0.2);
                    }

                    .btn-cyber-outline {
                        background: transparent;
                        color: var(--primary-color);
                        border: 1px solid var(--primary-color);
                        box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
                    }

                    .btn-cyber-outline-sm {
                        background: transparent;
                        color: var(--primary-color);
                        border: 1px solid var(--primary-color);
                        box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
                        padding: 0.25rem 0.5rem;
                        font-size: 0.875rem;
                    }

                    /* Efecto hover para botones */
                    .btn-hover {
                        transform: translateY(-2px);
                    }

                    .btn-cyber-primary.btn-hover {
                        box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
                    }

                    .btn-cyber-secondary.btn-hover {
                        box-shadow: 0 0 20px rgba(255, 0, 128, 0.5);
                    }

                    .btn-cyber-success.btn-hover {
                        box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
                    }

                    .btn-cyber-outline.btn-hover, .btn-cyber-outline-sm.btn-hover {
                        box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
                    }

                    /* Efecto active para botones */
                    .btn-active {
                        transform: translateY(1px);
                    }

                    /* Contenido del botón para centrado */
                    .btn-content {
                        position: relative;
                        z-index: 2;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                    }

                    /* Spinner para botones */
                    .btn-spinner {
                        width: 1rem;
                        height: 1rem;
                        border: 2px solid rgba(255, 255, 255, 0.3);
                        border-radius: 50%;
                        border-top-color: #fff;
                        animation: spin 0.8s linear infinite;
                        margin-right: 0.5rem;
                    }

                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }

                    /* Efecto de procesamiento para botones */
                    .btn-processing {
                        pointer-events: none;
                        opacity: 0.8;
                    }

                    .btn-processing::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transform: translateX(-100%);
                        animation: shimmer 1.5s infinite;
                        z-index: 0;
                    }

                    /* Efecto de partículas para botones */
                    .particles {
                        position: absolute;
                        width: 10px;
                        height: 10px;
                        border-radius: 50%;
                        background: transparent;
                        pointer-events: none;
                        z-index: 1;
                    }

                    .particles::before {
                        content: '';
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        border-radius: 50%;
                        background: var(--primary-color);
                        box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
                        animation: particle 1s forwards;
                        opacity: 0;
                    }

                    @keyframes particle {
                        0% {
                            transform: scale(0);
                            opacity: 1;
                        }
                        100% {
                            transform: scale(15);
                            opacity: 0;
                        }
                    }

                    /* Grupo de botones de acción */
                    .action-buttons {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 0.75rem;
                    }

                    /* Acordeón con estilo futurista */
                    .cyber-accordion .accordion-item {
                        background: rgba(25, 28, 39, 0.7);
                        border: 1px solid rgba(79, 195, 247, 0.2);
                        border-radius: var(--border-radius);
                        margin-bottom: 0.5rem;
                        overflow: hidden;
                    }

                    .cyber-accordion .accordion-header {
                        background: transparent;
                    }

                    .cyber-accordion .accordion-button {
                        background: rgba(30, 33, 44, 0.7);
                        color: var(--text-color);
                        font-weight: 500;
                        padding: 1rem;
                        box-shadow: none;
                    }

                    .cyber-accordion .accordion-button:not(.collapsed) {
                        background: rgba(41, 50, 65, 0.7);
                        color: var(--primary-color);
                    }

                    .cyber-accordion .accordion-button:focus {
                        box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
                        border-color: var(--primary-color);
                    }

                    .cyber-accordion .accordion-button::after {
                        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%230ff' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
                    }

                    /* Checkbox con estilo futurista */
                    .cyber-checkbox {
                        position: relative;
                        padding-left: 2.5rem;
                        cursor: pointer;
                        display: block;
                        margin-bottom: 0.75rem;
                    }

                    .cyber-checkbox-input {
                        position: absolute;
                        opacity: 0;
                        cursor: pointer;
                        height: 0;
                        width: 0;
                    }

                    .cyber-checkbox-label {
                        position: relative;
                        cursor: pointer;
                        font-size: 0.95rem;
                        color: var(--text-color);
                        user-select: none;
                    }

                    .cyber-checkbox-label::before {
                        content: '';
                        position: absolute;
                        left: -2.5rem;
                        top: 0;
                        width: 1.5rem;
                        height: 1.5rem;
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        background: rgba(15, 17, 26, 0.7);
                        border-radius: 4px;
                        transition: all 0.3s ease;
                    }

                    .cyber-checkbox-input:checked + .cyber-checkbox-label::before {
                        background: var(--primary-color);
                        border-color: var(--primary-color);
                        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
                    }

                    .cyber-checkbox-input:checked + .cyber-checkbox-label::after {
                        content: '';
                        position: absolute;
                        left: -2.1rem;
                        top: 0.4rem;
                        width: 0.75rem;
                        height: 0.4rem;
                        border-left: 2px solid #fff;
                        border-bottom: 2px solid #fff;
                        transform: rotate(-45deg);
                    }

                    .cyber-checkbox-input:focus + .cyber-checkbox-label::before {
                        box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
                    }

                    /* Radio buttons con estilo futurista */
                    .cyber-radio-group {
                        display: flex;
                        gap: 1rem;
                        flex-wrap: wrap;
                    }

                    .cyber-radio-input {
                        position: absolute;
                        opacity: 0;
                        cursor: pointer;
                        height: 0;
                        width: 0;
                    }

                    .cyber-radio-label {
                        position: relative;
                        cursor: pointer;
                        padding: 0.5rem 1rem;
                        padding-left: 2.5rem;
                        background: rgba(15, 17, 26, 0.7);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: 20px;
                        color: var(--text-color);
                        transition: all 0.3s ease;
                    }

                    .cyber-radio-label::before {
                        content: '';
                        position: absolute;
                        left: 0.75rem;
                        top: 50%;
                        transform: translateY(-50%);
                        width: 1rem;
                        height: 1rem;
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        background: rgba(15, 17, 26, 0.7);
                        border-radius: 50%;
                        transition: all 0.3s ease;
                    }

                    .cyber-radio-input:checked + .cyber-radio-label {
                        background: rgba(0, 255, 255, 0.1);
                        border-color: var(--primary-color);
                        box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
                    }

                    .cyber-radio-input:checked + .cyber-radio-label::before {
                        background: var(--primary-color);
                        border-color: var(--primary-color);
                        box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                    }

                    .cyber-radio-input:checked + .cyber-radio-label::after {
                        content: '';
                        position: absolute;
                        left: 0.95rem;
                        top: 50%;
                        transform: translateY(-50%);
                        width: 0.6rem;
                        height: 0.6rem;
                        background: #fff;
                        border-radius: 50%;
                    }

                    /* Tabs con estilo futurista */
                    .cyber-tabs {
                        border-bottom: 1px solid rgba(79, 195, 247, 0.2);
                    }

                    .cyber-tabs .nav-link {
                        color: var(--text-secondary);
                        background: transparent;
                        border: none;
                        border-bottom: 2px solid transparent;
                        padding: 0.75rem 1rem;
                        margin-right: 0.5rem;
                        border-radius: 0;
                        transition: all 0.3s ease;
                    }

                    .cyber-tabs .nav-link:hover {
                        color: var(--text-color);
                        background: rgba(0, 255, 255, 0.05);
                    }

                    .cyber-tabs .nav-link.active {
                        color: var(--primary-color);
                        background: transparent;
                        border-bottom: 2px solid var(--primary-color);
                        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                    }

                    /* Contenedor de código con estilo futurista */
                    .cyber-code-container {
                        background: rgba(15, 17, 26, 0.9);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: var(--border-radius);
                        padding: 1rem;
                        margin-bottom: 1rem;
                        position: relative;
                        overflow: auto;
                        max-height: 500px;
                    }

                    .cyber-code-container pre {
                        margin: 0;
                        padding: 0;
                        background: transparent;
                    }

                    .cyber-code-container code {
                        font-family: 'JetBrains Mono', 'Fira Code', monospace;
                        font-size: 0.9rem;
                        line-height: 1.5;
                    }

                    /* Estilo para diff */
                    .diff-added {
                        background-color: rgba(0, 255, 157, 0.1);
                        color: var(--success-color);
                        padding: 2px 0;
                        margin: 2px 0;
                        border-radius: 3px;
                        display: block;
                    }

                    .diff-removed {
                        background-color: rgba(255, 46, 110, 0.1);
                        color: var(--danger-color);
                        padding: 2px 0;
                        margin: 2px 0;
                        border-radius: 3px;
                        display: block;
                    }

                    .diff-unchanged {
                        padding: 2px 0;
                        margin: 2px 0;
                        display: block;
                    }

                    .diff-prefix {
                        display: inline-block;
                        width: 20px;
                        text-align: center;
                        margin-right: 10px;
                        font-weight: bold;
                    }

                    /* Estilo para diff lado a lado */
                    .diff-side-by-side {
                        display: flex;
                        gap: 1rem;
                    }

                    .diff-original, .diff-corrected {
                        flex: 1;
                        overflow: auto;
                    }

                    .diff-original h6, .diff-corrected h6 {
                        padding: 0.5rem;
                        margin-bottom: 0.5rem;
                        background: rgba(41, 50, 65, 0.7);
                        border-radius: var(--border-radius);
                        text-align: center;
                    }

                    .diff-content {
                        font-family: 'JetBrains Mono', 'Fira Code', monospace;
                        font-size: 0.85rem;
                        line-height: 1.5;
                    }

                    .diff-line {
                        padding: 2px 5px;
                        white-space: pre;
                        position: relative;
                        min-height: 1.5rem;
                    }

                    .line-number {
                        display: inline-block;
                        width: 30px;
                        text-align: right;
                        margin-right: 10px;
                        color: var(--text-secondary);
                        user-select: none;
                    }

                    /* Lista con estilo futurista */
                    .cyber-list {
                        background: rgba(15, 17, 26, 0.7);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: var(--border-radius);
                        overflow: hidden;
                    }

                    .cyber-list-header {
                        background: rgba(41, 50, 65, 0.7);
                        color: var(--primary-color);
                        padding: 0.75rem 1rem;
                        font-weight: 500;
                        border-bottom: 1px solid rgba(79, 195, 247, 0.2);
                        animation: fade-in 0.5s ease forwards;
                    }

                    .cyber-list-item {
                        padding: 0.75rem 1rem;
                        border-bottom: 1px solid rgba(79, 195, 247, 0.1);
                        transition: all 0.3s ease;
                        animation: fade-in 0.5s ease forwards;
                    }

                    .cyber-list-item:last-child {
                        border-bottom: none;
                    }

                    .cyber-list-item:hover {
                        background: rgba(0, 255, 255, 0.05);
                    }

                    /* Badges con estilo futurista */
                    .cyber-badge {
                        display: inline-block;
                        padding: 0.25rem 0.5rem;
                        font-size: 0.75rem;
                        font-weight: 500;
                        border-radius: 12px;
                        margin-right: 0.5rem;
                    }

                    .cyber-badge-info {
                        background: rgba(0, 149, 255, 0.1);
                        color: #0095ff;
                        border: 1px solid rgba(0, 149, 255, 0.3);
                    }

                    .cyber-badge-warning {
                        background: rgba(255, 183, 0, 0.1);
                        color: var(--warning-color);
                        border: 1px solid rgba(255, 183, 0, 0.3);
                    }

                    .cyber-badge-danger {
                        background: rgba(255, 46, 110, 0.1);
                        color: var(--danger-color);
                        border: 1px solid rgba(255, 46, 110, 0.3);
                    }

                    .cyber-badge-success {
                        background: rgba(0, 255, 157, 0.1);
                        color: var(--success-color);
                        border: 1px solid rgba(0, 255, 157, 0.3);
                    }

                    .cyber-badge-secondary {
                        background: rgba(150, 150, 200, 0.1);
                        color: #9696c8;
                        border: 1px solid rgba(150, 150, 200, 0.3);
                    }

                    /* Markdown con estilo futurista */
                    .cyber-markdown {
                        color: var(--text-color);
                        line-height: 1.6;
                    }

                    .cyber-markdown h1, .cyber-markdown h2, .cyber-markdown h3, .cyber-markdown h4, .cyber-markdown h5, .cyber-markdown h6 {
                        color: var(--primary-color);
                        margin-top: 1.5rem;
                        margin-bottom: 1rem;
                        text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
                    }

                    .cyber-markdown h1 {
                        font-size: 1.8rem;
                        border-bottom: 1px solid rgba(0, 255, 255, 0.2);
                        padding-bottom: 0.5rem;
                    }

                    .cyber-markdown h2 {
                        font-size: 1.5rem;
                    }

                    .cyber-markdown h3 {
                        font-size: 1.3rem;
                    }

                    .cyber-markdown p {
                        margin-bottom: 1rem;
                    }

                    .cyber-markdown code {
                        background: rgba(41, 50, 65, 0.7);
                        color: var(--primary-color);
                        padding: 0.2rem 0.4rem;
                        border-radius: 3px;
                        font-family: 'JetBrains Mono', 'Fira Code', monospace;
                        font-size: 0.9em;
                    }

                    .cyber-markdown pre {
                        background: rgba(15, 17, 26, 0.9);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: var(--border-radius);
                        padding: 1rem;
                        margin: 1rem 0;
                        overflow: auto;
                    }

                    .cyber-markdown pre code {
                        background: transparent;
                        padding: 0;
                        color: var(--text-color);
                    }

                    .cyber-markdown ul, .cyber-markdown ol {
                        margin-bottom: 1rem;
                        padding-left: 1.5rem;
                    }

                    .cyber-markdown li {
                        margin-bottom: 0.5rem;
                    }

                    .cyber-markdown blockquote {
                        border-left: 4px solid var(--primary-color);
                        padding-left: 1rem;
                        margin-left: 0;
                        color: var(--text-secondary);
                    }

                    .cyber-markdown hr {
                        border: none;
                        height: 1px;
                        background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
                        margin: 1.5rem 0;
                    }

                    .cyber-markdown a {
                        color: var(--primary-color);
                        text-decoration: none;
                        border-bottom: 1px dashed var(--primary-color);
                        transition: all 0.3s ease;
                    }

                    .cyber-markdown a:hover {
                        text-shadow: 0 0 5px var(--primary-color);
                        border-bottom: 1px solid var(--primary-color);
                    }

                    /* Tabla con estilo futurista */
                    .cyber-table {
                        width: 100%;
                        border-collapse: separate;
                        border-spacing: 0;
                        color: var(--text-color);
                    }

                    .cyber-table th {
                        background: rgba(41, 50, 65, 0.7);
                        color: var(--primary-color);
                        font-weight: 500;
                        text-align: left;
                        padding: 0.75rem 1rem;
                        border-bottom: 1px solid rgba(79, 195, 247, 0.3);
                    }

                    .cyber-table td {
                        padding: 0.75rem 1rem;
                        border-bottom: 1px solid rgba(79, 195, 247, 0.1);
                        transition: all 0.3s ease;
                    }

                    .cyber-table tr:last-child td {
                        border-bottom: none;
                    }

                    .cyber-table tr:hover td {
                        background: rgba(0, 255, 255, 0.05);
                    }

                    .cyber-value {
                        color: var(--primary-color);
                        font-weight: 500;
                        text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
                    }

                    /* Contenedor de gráficos con estilo futurista */
                    .chart-container {
                        background: rgba(15, 17, 26, 0.7);
                        border-radius: var(--border-radius);
                        padding: 1rem;
                        position: relative;
                    }

                    /* Dropdown con estilo futurista */
                    .cyber-dropdown {
                        background: rgba(25, 28, 39, 0.95);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: var(--border-radius);
                        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3), 0 0 15px rgba(0, 255, 255, 0.1);
                        padding: 0.5rem 0;
                        animation: dropdown-fade 0.2s ease;
                    }

                    @keyframes dropdown-fade {
                        from { opacity: 0; transform: translateY(-10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    .cyber-dropdown .dropdown-item {
                        color: var(--text-color);
                        padding: 0.6rem 1.2rem;
                        transition: all 0.2s ease;
                    }

                    .cyber-dropdown .dropdown-item:hover {
                        background: rgba(0, 255, 255, 0.1);
                        color: var(--primary-color);
                    }

                    .cyber-dropdown .dropdown-item i {
                        margin-right: 0.5rem;
                        color: var(--primary-color);
                    }

                    .cyber-dropdown .dropdown-divider {
                        border-top: 1px solid rgba(79, 195, 247, 0.2);
                        margin: 0.5rem 0;
                    }

                    /* Modal con estilo futurista */
                    .cyber-modal .modal-content {
                        background: rgba(25, 28, 39, 0.95);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: var(--border-radius);
                        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), 0 0 20px rgba(0, 255, 255, 0.1);
                        backdrop-filter: var(--glass-effect);
                        -webkit-backdrop-filter: var(--glass-effect);
                    }

                    .cyber-modal-header {
                        background: var(--gradient-primary);
                        color: #fff;
                        border-bottom: none;
                        padding: 1rem;
                        position: relative;
                        overflow: hidden;
                    }

                    .cyber-modal-header::before {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transform: translateX(-100%);
                        animation: shimmer 3s infinite;
                    }

                    .neon-close {
                        background: transparent;
                        border: none;
                        color: #fff;
                        font-size: 1.5rem;
                        line-height: 1;
                        opacity: 0.8;
                        text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
                        transition: all 0.3s ease;
                    }

                    .neon-close:hover {
                        opacity: 1;
                        text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
                        transform: rotate(90deg);
                    }

                    /* Barra de progreso con estilo futurista */
                    .cyber-progress {
                        height: 10px;
                        background: rgba(15, 17, 26, 0.7);
                        border-radius: 5px;
                        overflow: hidden;
                        margin: 1rem 0;
                    }

                    .cyber-progress-bar {
                        height: 100%;
                        background: linear-gradient(90deg, var(--primary-color), #0088ff);
                        border-radius: 5px;
                        transition: width 0.3s ease;
                        position: relative;
                        overflow: hidden;
                    }

                    .cyber-progress-bar::after {
                        content: '';
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
                        transform: translateX(-100%);
                        animation: shimmer 2s infinite;
                    }

                    .pulse {
                        animation: pulse-progress 0.5s ease;
                    }

                    @keyframes pulse-progress {
                        0% { opacity: 1; }
                        50% { opacity: 0.7; }
                        100% { opacity: 1; }
                    }

                    /* Spinner con estilo futurista */
                    .cyber-spinner {
                        display: inline-block;
                        width: 50px;
                        height: 50px;
                        position: relative;
                    }

                    .cyber-spinner-inner {
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        border-radius: 50%;
                        border: 3px solid transparent;
                        border-top-color: var(--primary-color);
                        animation: cyber-spin 1s linear infinite;
                    }

                    .cyber-spinner-inner::before {
                        content: '';
                        position: absolute;
                        top: 5px;
                        left: 5px;
                        right: 5px;
                        bottom: 5px;
                        border-radius: 50%;
                        border: 3px solid transparent;
                        border-top-color: var(--secondary-color);
                        animation: cyber-spin 1.5s linear infinite reverse;
                    }

                    .cyber-spinner-inner::after {
                        content: '';
                        position: absolute;
                        top: 15px;
                        left: 15px;
                        right: 15px;
                        bottom: 15px;
                        border-radius: 50%;
                        border: 3px solid transparent;
                        border-top-color: var(--success-color);
                        animation: cyber-spin 1.2s linear infinite;
                    }

                    @keyframes cyber-spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }

                    /* Alerta con estilo futurista para resultados */
                    .cyber-alert {
                        background: rgba(25, 28, 39, 0.7);
                        border-radius: var(--border-radius);
                        padding: 1rem;
                        margin-bottom: 1.5rem;
                        display: flex;
                        align-items: center;
                    }

                    .cyber-alert-success {
                        border-left: 4px solid var(--success-color);
                        box-shadow: 0 0 10px rgba(0, 255, 157, 0.1);
                    }

                    .cyber-alert-danger {
                        border-left: 4px solid var(--danger-color);
                        box-shadow: 0 0 10px rgba(255, 46, 110, 0.1);
                    }

                    .cyber-alert-warning {
                        border-left: 4px solid var(--warning-color);
                        box-shadow: 0 0 10px rgba(255, 183, 0, 0.1);
                    }

                    /* Búsqueda con estilo futurista */
                    .cyber-search {
                        position: relative;
                    }

                    .search-icon {
                        position: absolute;
                        left: 1rem;
                        top: 50%;
                        transform: translateY(-50%);
                        color: var(--text-secondary);
                        z-index: 1;
                    }

                    .cyber-search input {
                        background: rgba(15, 17, 26, 0.9);
                        border: 1px solid rgba(79, 195, 247, 0.3);
                        border-radius: 20px;
                        color: var(--text-color);
                        padding: 0.6rem 1rem 0.6rem 2.5rem;
                        width: 100%;
                        transition: all 0.3s ease;
                    }

                    .cyber-search input:focus {
                        outline: none;
                        border-color
                        ```css
                            .cyber-search input:focus {
                                outline: none;
                                border-color: var(--primary-color);
                                box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
                            }

                            /* Tooltip con estilo futurista */
                            .tooltip-trigger {
                                position: relative;
                                display: inline-block;
                            }

                            .cyber-tooltip {
                                position: absolute;
                                bottom: 100%;
                                left: 50%;
                                transform: translateX(-50%);
                                background: rgba(25, 28, 39, 0.95);
                                color: var(--text-color);
                                padding: 0.5rem 1rem;
                                border-radius: var(--border-radius);
                                border: 1px solid rgba(79, 195, 247, 0.3);
                                font-size: 0.85rem;
                                white-space: nowrap;
                                z-index: 1000;
                                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(0, 255, 255, 0.1);
                                pointer-events: none;
                                opacity: 0;
                                visibility: hidden;
                                transition: all 0.3s ease;
                            }

                            .cyber-tooltip::after {
                                content: '';
                                position: absolute;
                                top: 100%;
                                left: 50%;
                                transform: translateX(-50%);
                                border-width: 5px;
                                border-style: solid;
                                border-color: rgba(79, 195, 247, 0.3) transparent transparent transparent;
                            }

                            .show-tooltip {
                                opacity: 1;
                                visibility: visible;
                                transform: translateX(-50%) translateY(-10px);
                            }

                            /* Toast con estilo futurista */
                            .cyber-toast {
                                background: rgba(25, 28, 39, 0.95);
                                color: var(--text-color);
                                border-radius: var(--border-radius);
                                border-left: 4px solid var(--primary-color);
                                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3), 0 0 10px rgba(0, 255, 255, 0.1);
                                margin-bottom: 0.75rem;
                                max-width: 350px;
                                backdrop-filter: var(--glass-effect);
                                -webkit-backdrop-filter: var(--glass-effect);
                                opacity: 0;
                                transform: translateX(100%);
                                transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
                            }

                            .toast-success {
                                border-left: 4px solid var(--success-color);
                            }

                            .toast-error {
                                border-left: 4px solid var(--danger-color);
                            }

                            .toast-warning {
                                border-left: 4px solid var(--warning-color);
                            }

                            .toast-info {
                                border-left: 4px solid var(--primary-color);
                            }

                            .cyber-toast-header {
                                display: flex;
                                align-items: center;
                                padding: 0.5rem 1rem;
                                background: rgba(15, 17, 26, 0.5);
                                border-bottom: 1px solid rgba(79, 195, 247, 0.2);
                            }

                            .cyber-toast-body {
                                padding: 0.75rem 1rem;
                            }

                            .show-toast {
                                opacity: 1;
                                transform: translateX(0);
                            }

                            .hide-toast {
                                opacity: 0;
                                transform: translateX(100%);
                            }

                            /* Encabezados con estilo futurista */
                            .cyber-heading {
                                color: var(--primary-color);
                                margin-bottom: 1rem;
                                text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
                                font-weight: 500;
                                letter-spacing: 0.5px;
                            }

                            /* Iconos con brillo */
                            .cyber-icon-glow {
                                color: var(--primary-color);
                                text-shadow: 0 0 5px var(--primary-color);
                            }

                            /* Animaciones */
                            @keyframes fade-in {
                                from { opacity: 0; }
                                to { opacity: 1; }
                            }

                            .fade-in {
                                animation: fade-in 0.5s ease forwards;
                            }

                            .fade-out {
                                animation: fade-out 0.3s ease forwards;
                            }

                            @keyframes fade-out {
                                from { opacity: 1; }
                                to { opacity: 0; }
                            }

                            .slide-up {
                                animation: slide-up 0.5s ease forwards;
                            }

                            @keyframes slide-up {
                                from { opacity: 0; transform: translateY(20px); }
                                to { opacity: 1; transform: translateY(0); }
                            }

                            .slide-down {
                                animation: slide-down 0.3s ease forwards;
                            }

                            @keyframes slide-down {
                                from { opacity: 1; transform: translateY(0); }
                                to { opacity: 0; transform: translateY(20px); }
                            }

                            .slide-in-right {
                                animation: slide-in-right 0.5s ease forwards;
                            }

                            @keyframes slide-in-right {
                                from { opacity: 0; transform: translateX(20px); }
                                to { opacity: 1; transform: translateX(0); }
                            }

                            .highlight-item {
                                animation: highlight 0.5s ease;
                            }

                            @keyframes highlight {
                                0% { background-color: transparent; }
                                50% { background-color: rgba(0, 255, 255, 0.1); }
                                100% { background-color: transparent; }
                            }

                            .fade-out-item {
                                animation: fade-out-item 0.3s ease forwards;
                            }

                            @keyframes fade-out-item {
                                from { opacity: 1; transform: translateX(0); }
                                to { opacity: 0; transform: translateX(-10px); }
                            }

                            .flash {
                                animation: flash 0.3s ease;
                            }

                            @keyframes flash {
                                0% { background-color: transparent; }
                                50% { background-color: rgba(0, 255, 255, 0.1); }
                                100% { background-color: transparent; }
                            }

                            .pulse-error {
                                animation: pulse-error 2s infinite;
                            }

                            @keyframes pulse-error {
                                0% { text-shadow: 0 0 0 rgba(255, 46, 110, 0); }
                                50% { text-shadow: 0 0 10px rgba(255, 46, 110, 0.5); }
                                100% { text-shadow: 0 0 0 rgba(255, 46, 110, 0); }
                            }

                            /* Efecto de escritura para explicaciones */
                            .typing-effect {
                                position: relative;
                            }

                            .typing-effect::after {
                                content: '|';
                                position: absolute;
                                right: 0;
                                animation: blink 1s infinite;
                            }

                            @keyframes blink {
                                0%, 100% { opacity: 1; }
                                50% { opacity: 0; }
                            }

                            /* Estilos para números de línea */
                            .with-line-numbers {
                                counter-reset: line;
                            }

                            .with-line-numbers .line-number {
                                counter-increment: line;
                            }

                            .with-line-numbers .line-number::before {
                                content: counter(line);
                                display: inline-block;
                                width: 2em;
                                padding-right: 1em;
                                text-align: right;
                                color: var(--text-secondary);
                            }

                            /* Desactivar resaltado de sintaxis */
                            .no-highlight {
                                color: var(--text-color) !important;
                            }

                            .no-highlight .hljs-keyword,
                            .no-highlight .hljs-selector-tag,
                            .no-highlight .hljs-title,
                            .no-highlight .hljs-section,
                            .no-highlight .hljs-doctag,
                            .no-highlight .hljs-name,
                            .no-highlight .hljs-strong,
                            .no-highlight .hljs-comment,
                            .no-highlight .hljs-string,
                            .no-highlight .hljs-built_in,
                            .no-highlight .hljs-literal,
                            .no-highlight .hljs-type,
                            .no-highlight .hljs-addition,
                            .no-highlight .hljs-tag,
                            .no-highlight .hljs-quote,
                            .no-highlight .hljs-selector-id,
                            .no-highlight .hljs-selector-class,
                            .no-highlight .hljs-meta,
                            .no-highlight .hljs-subst,
                            .no-highlight .hljs-symbol,
                            .no-highlight .hljs-regexp,
                            .no-highlight .hljs-attribute,
                            .no-highlight .hljs-deletion,
                            .no-highlight .hljs-variable,
                            .no-highlight .hljs-template-variable,
                            .no-highlight .hljs-link,
                            .no-highlight .hljs-bullet,
                            .no-highlight .hljs-emphasis {
                                color: var(--text-color) !important;
                            }

                            /* Estilos responsivos */
                            @media (max-width: 768px) {
                                .diff-side-by-side {
                                    flex-direction: column;
                                }

                                .diff-original, .diff-corrected {
                                    width: 100%;
                                }

                                .action-buttons {
                                    flex-direction: column;
                                }

                                .action-buttons .btn {
                                    width: 100%;
                                    margin-bottom: 0.5rem;
                                }

                                .cyber-radio-group {
                                    flex-direction: column;
                                }

                                .cyber-radio-label {
                                    width: 100%;
                                    margin-bottom: 0.5rem;
                                }
                            }

                            /* Estilos para estados */
                            .status-success {
                                color: var(--success-color);
                                font-weight: 500;
                            }

                            .status-warning {
                                color: var(--warning-color);
                                font-weight: 500;
                            }

                            .status-error {
                                color: var(--danger-color);
                                font-weight: 500;
                            }

                            /* Personalización de scrollbar */
                            ::-webkit-scrollbar {
                                width: 8px;
                                height: 8px;
                            }

                            ::-webkit-scrollbar-track {
                                background: rgba(15, 17, 26, 0.7);
                                border-radius: 4px;
                            }

                            ::-webkit-scrollbar-thumb {
                                background: rgba(79, 195, 247, 0.3);
                                border-radius: 4px;
                            }

                            ::-webkit-scrollbar-thumb:hover {
                                background: rgba(79, 195, 247, 0.5);
                            }

                            /* Estilos para selección de texto */
                            ::selection {
                                background: rgba(0, 255, 255, 0.2);
                                color: var(--primary-color);
                            }
                        </style>
                        {% endblock %}